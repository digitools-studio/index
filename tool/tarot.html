<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>塔羅學習與分享指南</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for a clean, cohesive look */
        :root {
            --primary-color: #7d449e;
            --secondary-color: #3b2c6a;
            --accent-color: #fddb92;
            --text-color: #e0d9e7;
            --bg-color-dark: #120e24;
            --bg-color-light: #251e44;
            --card-bg: rgba(253, 219, 146, 0.08);
            --border-radius: 12px;
            --shadow-light: 0 4px 8px rgba(0, 0, 0, 0.25);
            --shadow-dark: 0 8px 20px rgba(0, 0, 0, 0.6);
            --card-back-color: #4B2424;
        }

        /* Base & Global Styles */
        body {
            font-family: 'Noto Sans TC', 'Noto Sans JP', sans-serif;
            background: var(--bg-color-dark) url('https://placehold.co/1920x1080/0d0b1a/1a1a2e?text=') no-repeat center center fixed;
            background-size: cover;
            color: var(--text-color);
            margin: 0;
            padding: 2rem 1rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            position: relative;
            box-sizing: border-box;
            line-height: 1.6;
        }

        #app {
            width: 100%;
            max-width: 960px;
            background-color: var(--bg-color-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-dark);
            padding: 2.5rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        h1, h2, h3 {
            color: var(--accent-color);
            font-family: 'Playfair Display', serif;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 1rem;
        }
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }

        p {
            line-height: 1.8;
            color: var(--text-color);
        }

        .button, .language-select {
            background-color: var(--primary-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-light);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            font-weight: 500;
        }
        .button:hover, .language-select:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        .button.secondary {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        .button.secondary:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Language & Feedback */
        .top-bar {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .language-select {
            padding: 0.5rem 1rem;
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        /* Common Page Layouts */
        .page-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .page-header h2 {
            margin: 0;
            flex-grow: 1;
        }
        .page-header .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Reading Page */
        #reading-page input[type="text"] {
            width: 80%;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary-color);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
            font-size: 1rem;
        }
        #reading-page input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        #reading-page .spread-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 2rem;
            width: 100%;
            justify-items: center;
            align-items: center;
        }
        #reading-page .spread-positions {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            width: 100%;
            align-items: flex-start;
        }
        #reading-page .position-item {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            width: 100%;
            box-shadow: var(--shadow-light);
            text-align: left;
        }
        #reading-page .position-item h4 {
            margin: 0 0 0.5rem 0;
        }
        
        /* Card Flip Animation */
        .card-container {
            width: 80px;
            height: 140px;
            perspective: 1000px;
            cursor: pointer;
            flex-shrink: 0;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-style: preserve-3d;
        }
        .card-inner.is-flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            background-size: cover;
            background-position: center;
        }
        .card-front {
            transform: rotateY(180deg);
        }
        .card-back {
            background-color: var(--card-back-color);
            border: 2px solid var(--accent-color);
            background-image: url('https://placehold.co/200x350/4B2424/FFFFFF?text=TAROT');
            background-size: contain;
            background-repeat: no-repeat;
        }
        .card-back.is-shuffling {
            animation: card-shuffle 1s infinite alternate;
        }

        #interpretation-section {
            width: 100%;
            margin-top: 2rem;
        }
        #interpretation-section textarea {
            width: 100%;
            min-height: 150px;
            padding: 1rem;
            border-radius: var(--border-radius);
            border: 2px solid var(--primary-color);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
            font-size: 1rem;
            box-sizing: border-box;
            line-height: 1.6;
        }
        #interpretation-section .share-button-container {
            margin-top: 1rem;
            text-align: right;
        }

        /* All Cards Page */
        #all-cards-page .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            width: 100%;
            justify-items: center;
        }
        #all-cards-page .card-item {
            width: 100%;
            max-width: 150px;
            padding: 1rem;
            border-radius: var(--border-radius);
            transition: transform 0.3s ease;
            cursor: pointer;
            text-align: center;
        }
        #all-cards-page .card-item:hover {
            transform: translateY(-5px);
            background-color: rgba(255, 255, 255, 0.05);
        }
        #all-cards-page .card-item img {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
            margin-bottom: 0.5rem;
        }

        /* Modal for card details and feedback */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal-content {
            background-color: var(--bg-color-light);
            padding: 2rem;
            border-radius: var(--border-radius);
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: var(--shadow-dark);
            max-height: 90vh;
            overflow-y: auto;
            text-align: left;
        }
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: var(--text-color);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
        }

        #feedback-form input, #feedback-form textarea {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--primary-color);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
            font-size: 1rem;
            box-sizing: border-box;
        }
        #feedback-form textarea {
            min-height: 100px;
        }
        #feedback-form button {
            width: 100%;
        }

        /* Footer */
        .footer {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
            text-align: right;
            padding: 0.5rem;
        }

        /* Media Queries */
        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }
            #app {
                padding: 1.5rem;
            }
            .page-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            .page-header .action-buttons {
                justify-content: center;
            }
        }
        
    </style>
</head>
<body>
    <div id="app"></div>
    <div id="card-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="modal-content-inner"></div>
        </div>
    </div>
    <div id="feedback-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="feedback-form-container">
                <h3></h3>
                <form id="feedback-form">
                    <input type="email" id="feedback-email" placeholder="Your Email (Optional)">
                    <textarea id="feedback-text" placeholder="Your feedback"></textarea>
                    <button type="submit" class="button"></button>
                </form>
            </div>
        </div>
    </div>
    <footer class="footer">
        <p>POWER BY 數轉工作室</p>
    </footer>

    <script>
        const localizationData = {
            'zh-TW': {
                appTitle: '塔羅學習與分享指南',
                homeTitle: '歡迎來到塔羅學習筆記本',
                homeIntro: '選擇一個你感興趣的牌陣來開始你的占卜，或探索牌卡來累積你的知識！',
                startReading: '開始占卜',
                browseCards: '瀏覽所有牌卡',
                browseAllCardsTitle: '所有塔羅牌卡',
                browseIntro: '點擊任何一張牌，可以查看它的詳細含義。',
                questionTitle: '專注你的問題...',
                questionIntro: '請在心中默想你的問題，並在這裡簡要寫下，讓思緒更清晰。',
                questionPlaceholder: '例如：我該如何改善我的職場人際關係？',
                startDraw: '開始抽牌',
                shuffle: '重新抽牌',
                yourQuestion: '你的問題：',
                readingIntro: '請依序點擊牌陣上的牌來翻開它們。',
                interpretationTitle: '我的解讀與筆記',
                notesIntro: '在這裡寫下你的想法，將占卜結果轉化為個人經驗。',
                notesPlaceholder: '例如：我認為這張牌代表我需要放下過去的包袱...',
                copyShare: '複製分享',
                back: '返回',
                upright: '正位',
                reversed: '逆位',
                keywords: '關鍵字',
                meaning: '意義',
                positionMeaning: '牌位意義',
                copySuccess: '已成功將結果複製到剪貼簿！',
                copyFail: '複製失敗，請手動複製。',
                feedbackButton: '回饋',
                feedbackTitle: '您的回饋',
                feedbackSubmit: '送出回饋',
                feedbackSuccess: '感謝您的回饋！',
                feedbackEmailPlaceholder: '您的電子郵件（可選）',
                feedbackTextPlaceholder: '您的回饋...',
            },
            'en': {
                appTitle: 'Tarot Learning & Sharing Guide',
                homeTitle: 'Welcome to the Tarot Learning Journal',
                homeIntro: 'Choose a spread to start your reading, or explore the cards to deepen your knowledge!',
                startReading: 'Start a Reading',
                browseCards: 'Browse All Cards',
                browseAllCardsTitle: 'All Tarot Cards',
                browseIntro: 'Click on any card to view its detailed meaning.',
                questionTitle: 'Focus on Your Question...',
                questionIntro: 'Please silently think of your question and write it here to clarify your thoughts.',
                questionPlaceholder: 'e.g., How can I improve my relationships at work?',
                startDraw: 'Start Drawing',
                shuffle: 'Shuffle Again',
                yourQuestion: 'Your Question:',
                readingIntro: 'Please click on the cards in order to reveal them.',
                interpretationTitle: 'My Interpretation & Notes',
                notesIntro: 'Write down your thoughts here to transform the reading into a personal experience.',
                notesPlaceholder: 'e.g., I think this card means I need to let go of past burdens...',
                copyShare: 'Copy & Share',
                back: 'Back',
                upright: 'Upright',
                reversed: 'Reversed',
                keywords: 'Keywords',
                meaning: 'Meaning',
                positionMeaning: 'Position Meaning',
                copySuccess: 'Successfully copied to clipboard!',
                copyFail: 'Copy failed, please copy manually.',
                feedbackButton: 'Feedback',
                feedbackTitle: 'Your Feedback',
                feedbackSubmit: 'Submit Feedback',
                feedbackSuccess: 'Thank you for your feedback!',
                feedbackEmailPlaceholder: 'Your Email (Optional)',
                feedbackTextPlaceholder: 'Your feedback...',
            },
            'ja': {
                appTitle: 'タロット学習＆共有ガイド',
                homeTitle: 'タロット学習ノートへようこそ',
                homeIntro: '占いを始めるためにスプレッドを選んだり、カードを探求して知識を深めましょう！',
                startReading: '占いを始める',
                browseCards: 'すべてのカードを見る',
                browseAllCardsTitle: 'すべてのタロットカード',
                browseIntro: 'カードをクリックすると詳細な意味を見ることができます。',
                questionTitle: '質問に集中する...',
                questionIntro: '心の中で質問を思い浮かべ、ここに簡潔に書き出して思考を明確にしましょう。',
                questionPlaceholder: '例：職場での人間関係を改善するにはどうすればいいですか？',
                startDraw: 'カードを引く',
                shuffle: '引き直し',
                yourQuestion: 'あなたの質問：',
                readingIntro: '順番にカードをクリックして開いてください。',
                interpretationTitle: '私の解釈とメモ',
                notesIntro: 'ここにあなたの考えを書き留め、占いの結果を個人的な経験に変えましょう。',
                notesPlaceholder: '例：このカードは過去の重荷を手放す必要があることを意味していると思います...',
                copyShare: 'コピーして共有',
                back: '戻る',
                upright: '正位置',
                reversed: '逆位置',
                keywords: 'キーワード',
                meaning: '意味',
                positionMeaning: 'カードの位置の意味',
                copySuccess: 'クリップボードに正常にコピーされました！',
                copyFail: 'コピーに失敗しました。手動でコピーしてください。',
                feedbackButton: 'フィードバック',
                feedbackTitle: 'フィードバック',
                feedbackSubmit: 'フィードバックを送る',
                feedbackSuccess: 'フィードバックありがとうございます！',
                feedbackEmailPlaceholder: 'あなたのメール（任意）',
                feedbackTextPlaceholder: 'あなたのフィードバック...',
            },
        };

        const tarotCards = [
            // Major Arcana
            { id: 'major0', name: { 'zh-TW': '愚人 (The Fool)', 'en': 'The Fool', 'ja': '愚者 (The Fool)' }, image: 'C:\Users\User\Desktop\個人Demo平台&履歷\Demo平台\Git Hub Page\digitools-studio\Static\tarot_card\The Fool.png', upright: { keywords: { 'zh-TW': ['開始', '潛力', '自由'], 'en': ['Beginnings', 'Potential', 'Freedom'], 'ja': ['始まり', '可能性', '自由'] }, meaning: { 'zh-TW': '代表一段全新旅程的開始，充滿無限可能與未知。', 'en': 'Represents the beginning of a new journey, full of infinite possibilities and the unknown.', 'ja': '無限の可能性と未知に満ちた、新しい旅の始まりを表します。' } }, reversed: { keywords: { 'zh-TW': ['魯莽', '冒險', '不負責'], 'en': ['Recklessness', 'Risk', 'Irresponsibility'], 'ja': ['無謀', '危険', '無責任'] }, meaning: { 'zh-TW': '可能象徵行動過於衝動，缺乏計畫與考慮。', 'en': 'May symbolize reckless actions, lacking planning and consideration.', 'ja': '計画や考慮を欠いた、無謀な行動を象徴する可能性があります。' } } },
            { id: 'major1', name: { 'zh-TW': '魔術師 (The Magician)', 'en': 'The Magician', 'ja': '魔術師 (The Magician)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=魔術師', upright: { keywords: { 'zh-TW': ['行動', '創造', '才能'], 'en': ['Action', 'Creativity', 'Talent'], 'ja': ['行動', '創造', '才能'] }, meaning: { 'zh-TW': '代表擁有將想法化為現實的能力與資源。', 'en': 'Represents having the ability and resources to turn ideas into reality.', 'ja': 'アイデアを現実に変える能力とリソースを持っていることを表します。' } }, reversed: { keywords: { 'zh-TW': ['欺騙', '操縱', '缺乏技巧'], 'en': ['Deception', 'Manipulation', 'Lack of Skill'], 'ja': ['欺瞞', '操作', '技術不足'] }, meaning: { 'zh-TW': '可能表示技能沒有被妥善運用，或存在欺瞞。', 'en': 'May indicate skills are not being used properly, or there is deceit.', 'ja': 'スキルが適切に活用されていない、あるいは欺瞞があることを示している可能性があります。' } } },
            { id: 'major2', name: { 'zh-TW': '女祭司 (The High Priestess)', 'en': 'The High Priestess', 'ja': '女教皇 (The High Priestess)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=女祭司', upright: { keywords: { 'zh-TW': ['直覺', '潛意識', '智慧'], 'en': ['Intuition', 'Subconscious', 'Wisdom'], 'ja': ['直感', '潜在意識', '知恵'] }, meaning: { 'zh-TW': '代表內在的智慧與直覺力量，引導你做出正確判斷。', 'en': 'Represents inner wisdom and intuitive power, guiding you to make correct judgments.', 'ja': '内なる知恵と直感の力を表し、正しい判断を下すように導きます。' } }, reversed: { keywords: { 'zh-TW': ['隱藏', '秘密', '表面'], 'en': ['Hidden', 'Secrets', 'Superficial'], 'ja': ['隠蔽', '秘密', '表面的'] }, meaning: { 'zh-TW': '可能表示直覺被忽視，或有隱藏的真相未被發現。', 'en': 'May indicate intuition is being ignored, or a hidden truth is undiscovered.', 'ja': '直感が無視されている、または隠された真実が発見されていないことを示している可能性があります。' } } },
            { id: 'major3', name: { 'zh-TW': '皇后 (The Empress)', 'en': 'The Empress', 'ja': '女帝 (The Empress)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=皇后', upright: { keywords: { 'zh-TW': ['豐收', '創造', '滋養'], 'en': ['Abundance', 'Creation', 'Nurturing'], 'ja': ['豊かさ', '創造', '育むこと'] }, meaning: { 'zh-TW': '代表豐沛的創造力與溫暖的母性力量，預示著成長與美好。', 'en': 'Represents abundant creativity and nurturing maternal energy, foretelling growth and beauty.', 'ja': '豊かな創造力と温かい母性の力を表し、成長と美しさを示唆します。' } }, reversed: { keywords: { 'zh-TW': ['停滯', '空虛', '不孕'], 'en': ['Stagnation', 'Emptiness', 'Infertility'], 'ja': ['停滞', '虚無', '不毛'] }, meaning: { 'zh-TW': '可能象徵創造力受阻，或關係中缺乏滋養。', 'en': 'May symbolize blocked creativity or a lack of nurturing in a relationship.', 'ja': '創造性が妨げられたり、人間関係において育む力が欠けていることを象徴する可能性があります。' } } },
            { id: 'major4', name: { 'zh-TW': '皇帝 (The Emperor)', 'en': 'The Emperor', 'ja': '皇帝 (The Emperor)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=皇帝', upright: { keywords: { 'zh-TW': ['權威', '領導', '紀律'], 'en': ['Authority', 'Leadership', 'Discipline'], 'ja': ['権威', 'リーダーシップ', '規律'] }, meaning: { 'zh-TW': '代表秩序、權威與掌控，是實現目標的堅定力量。', 'en': 'Represents order, authority, and control, a steadfast force for achieving goals.', 'ja': '秩序、権威、支配を表し、目標達成のための揺るぎない力です。' } }, reversed: { keywords: { 'zh-TW': ['獨裁', '缺乏控制', '霸道'], 'en': ['Tyranny', 'Lack of Control', 'Domineering'], 'ja': ['独裁', '制御不能', '横暴'] }, meaning: { 'zh-TW': '可能表示過於強勢，或在權力上有所不足。', 'en': 'May indicate being too overbearing, or a lack of power.', 'ja': '強引すぎる、または権力が不足していることを示している可能性があります。' } } },
            { id: 'major5', name: { 'zh-TW': '教皇 (The Hierophant)', 'en': 'The Hierophant', 'ja': '法王 (The Hierophant)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=教皇', upright: { keywords: { 'zh-TW': ['傳統', '教育', '信仰'], 'en': ['Tradition', 'Education', 'Beliefs'], 'ja': ['伝統', '教育', '信仰'] }, meaning: { 'zh-TW': '代表遵守傳統與既有規範，尋求精神上的導師。', 'en': 'Represents adherence to tradition and established norms, seeking spiritual guidance.', 'ja': '伝統と既存の規範を遵守し、精神的な導きを求めることを表します。' } }, reversed: { keywords: { 'zh-TW': ['反叛', '非正統', '限制'], 'en': ['Rebellion', 'Unconventional', 'Restriction'], 'ja': ['反逆', '型破り', '制限'] }, meaning: { 'zh-TW': '可能表示你正挑戰傳統，或陷入僵化的思維。', 'en': 'May indicate that you are challenging tradition, or are stuck in rigid thinking.', 'ja': 'あなたが伝統に挑戦している、あるいは硬直した思考に陥っていることを示している可能性があります。' } } },
            { id: 'major6', name: { 'zh-TW': '戀人 (The Lovers)', 'en': 'The Lovers', 'ja': '恋人 (The Lovers)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=戀人', upright: { keywords: { 'zh-TW': ['愛情', '選擇', '結合'], 'en': ['Love', 'Choice', 'Union'], 'ja': ['愛', '選択', '結合'] }, meaning: { 'zh-TW': '象徵選擇與承諾，以及兩個人或兩種力量的結合。', 'en': 'Symbolizes choice and commitment, and the union of two people or two forces.', 'ja': '選択とコミットメント、そして二人の人物または二つの力の結合を象徴します。' } }, reversed: { keywords: { 'zh-TW': ['分離', '衝突', '不協調'], 'en': ['Separation', 'Conflict', 'Disharmony'], 'ja': ['分離', '衝突', '不調和'] }, meaning: { 'zh-TW': '可能表示關係中的矛盾或錯誤的選擇。', 'en': 'May indicate contradictions in a relationship or a wrong choice.', 'ja': '人間関係における矛盾や間違った選択を示している可能性があります。' } } },
            { id: 'major7', name: { 'zh-TW': '戰車 (The Chariot)', 'en': 'The Chariot', 'ja': '戦車 (The Chariot)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=戰車', upright: { keywords: { 'zh-TW': ['勝利', '意志', '決心'], 'en': ['Victory', 'Willpower', 'Determination'], 'ja': ['勝利', '意志力', '決意'] }, meaning: { 'zh-TW': '代表透過堅定的意志與自律，克服困難並取得成功。', 'en': 'Represents overcoming difficulties and achieving success through strong will and self-discipline.', 'ja': '強い意志と自己規律を通じて困難を克服し、成功を収めることを表します。' } }, reversed: { keywords: { 'zh-TW': ['挫敗', '失控', '方向不明'], 'en': ['Defeat', 'Loss of Control', 'Lack of Direction'], 'ja': ['敗北', '制御不能', '方向性の欠如'] }, meaning: { 'zh-TW': '可能表示行動受阻，或失去對局勢的掌控。', 'en': 'May indicate blocked progress or a loss of control over the situation.', 'ja': '進展が妨げられたり、状況のコントロールを失っていることを示している可能性があります。' } } },
            { id: 'major8', name: { 'zh-TW': '力量 (Strength)', 'en': 'Strength', 'ja': '力 (Strength)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=力量', upright: { keywords: { 'zh-TW': ['勇氣', '耐心', '同理心'], 'en': ['Courage', 'Patience', 'Empathy'], 'ja': ['勇気', '忍耐', '共感'] }, meaning: { 'zh-TW': '代表內在的勇氣與柔韌，能以溫柔的力量駕馭野性。', 'en': 'Represents inner courage and resilience, taming wildness with gentle strength.', 'ja': '内なる勇気と回復力を表し、穏やかな力で野性を手なずけます。' } }, reversed: { keywords: { 'zh-TW': ['怯懦', '不耐煩', '自我懷疑'], 'en': ['Cowardice', 'Impatience', 'Self-doubt'], 'ja': ['臆病', '短気', '自己不信'] }, meaning: { 'zh-TW': '可能表示你正在與內在的恐懼作鬥爭。', 'en': 'May indicate that you are struggling with inner fears.', 'ja': 'あなたが内なる恐怖と闘っていることを示している可能性があります。' } } },
            { id: 'major9', name: { 'zh-TW': '隱者 (The Hermit)', 'en': 'The Hermit', 'ja': '隠者 (The Hermit)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=隱者', upright: { keywords: { 'zh-TW': ['內省', '孤獨', '指引'], 'en': ['Introspection', 'Solitude', 'Guidance'], 'ja': ['内省', '孤独', '導き'] }, meaning: { 'zh-TW': '代表尋求內在智慧與真理，在獨處中獲得成長。', 'en': 'Represents seeking inner wisdom and truth, gaining growth in solitude.', 'ja': '内なる知恵と真理を求め、孤独の中で成長することを表します。' } }, reversed: { keywords: { 'zh-TW': ['孤立', '迷失', '逃避'], 'en': ['Isolation', 'Lost', 'Avoidance'], 'ja': ['孤立', '迷い', '逃避'] }, meaning: { 'zh-TW': '可能表示你正在逃避現實，或感到與社會脫節。', 'en': 'May indicate you are avoiding reality, or feeling disconnected from society.', 'ja': 'あなたが現実から逃げている、または社会から切り離されていると感じていることを示している可能性があります。' } } },
            { id: 'major10', name: { 'zh-TW': '命運之輪 (Wheel of Fortune)', 'en': 'Wheel of Fortune', 'ja': '運命の輪 (Wheel of Fortune)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=命運之輪', upright: { keywords: { 'zh-TW': ['改變', '好運', '轉機'], 'en': ['Change', 'Good Luck', 'Turning Point'], 'ja': ['変化', '幸運', '転機'] }, meaning: { 'zh-TW': '代表命運的轉變與不可預測的事件。', 'en': 'Represents a turn of fate and unpredictable events.', 'ja': '運命の転換と予測不可能な出来事を表します。' } }, reversed: { keywords: { 'zh-TW': ['壞運', '停滯', '延遲'], 'en': ['Bad Luck', 'Stagnation', 'Delays'], 'ja': ['不運', '停滞', '遅延'] }, meaning: { 'zh-TW': '可能表示改變的機會被錯過，或事態停滯不前。', 'en': 'May indicate a missed opportunity for change, or a standstill in events.', 'ja': '変化の機会を逃した、または事態が停滞していることを示している可能性があります。' } } },
            { id: 'major11', name: { 'zh-TW': '正義 (Justice)', 'en': 'Justice', 'ja': '正義 (Justice)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=正義', upright: { keywords: { 'zh-TW': ['公正', '真相', '平衡'], 'en': ['Fairness', 'Truth', 'Balance'], 'ja': ['公正', '真実', 'バランス'] }, meaning: { 'zh-TW': '代表客觀的判斷與尋求真相，做出公平的決定。', 'en': 'Represents objective judgment and the pursuit of truth, making fair decisions.', 'ja': '客観的な判断と真実の追求を表し、公正な決定を下します。' } }, reversed: { keywords: { 'zh-TW': ['不公', '偏見', '逃避責任'], 'en': ['Injustice', 'Bias', 'Avoiding Responsibility'], 'ja': ['不正', '偏見', '責任回避'] }, meaning: { 'zh-TW': '可能表示你正陷入不公平的處境，或逃避後果。', 'en': 'May indicate you are in an unfair situation, or are avoiding consequences.', 'ja': 'あなたが不公平な状況に置かれている、または結果から逃げていることを示している可能性があります。' } } },
            { id: 'major12', name: { 'zh-TW': '吊人 (The Hanged Man)', 'en': 'The Hanged Man', 'ja': '吊るされた男 (The Hanged Man)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=吊人', upright: { keywords: { 'zh-TW': ['犧牲', '新視角', '放手'], 'en': ['Sacrifice', 'New Perspective', 'Letting Go'], 'ja': ['犠牲', '新しい視点', '手放す'] }, meaning: { 'zh-TW': '代表從不同的角度看問題，透過暫停與犧牲來獲得啟示。', 'en': 'Represents seeing things from a different angle, gaining enlightenment through suspension and sacrifice.', 'ja': '異なる角度から物事を見ること、一時停止と犠牲を通じて啓示を得ることを表します。' } }, reversed: { keywords: { 'zh-TW': ['固執', '拖延', '無謂的犧牲'], 'en': ['Stubbornness', 'Procrastination', 'Meaningless Sacrifice'], 'ja': ['頑固', '遅延', '無駄な犠牲'] }, meaning: { 'zh-TW': '可能表示你困在一個處境中，不願做出必要的改變。', 'en': 'May indicate you are stuck in a situation, unwilling to make necessary changes.', 'ja': 'あなたが状況に閉じ込められ、必要な変化を起こすことをためらっていることを示している可能性があります。' } } },
            { id: 'major13', name: { 'zh-TW': '死神 (Death)', 'en': 'Death', 'ja': '死神 (Death)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=死神', upright: { keywords: { 'zh-TW': ['結束', '轉變', '重生'], 'en': ['Ending', 'Transition', 'Rebirth'], 'ja': ['終わり', '変化', '再生'] }, meaning: { 'zh-TW': '代表舊事物的結束與新事物的誕生，是一個必然的轉變。', 'en': 'Represents the end of old things and the birth of new ones, an inevitable transition.', 'ja': '古いものの終わりと新しいものの誕生を表す、必然的な変化です。' } }, reversed: { keywords: { 'zh-TW': ['停滯', '恐懼改變', '抗拒'], 'en': ['Stagnation', 'Fear of Change', 'Resistance'], 'ja': ['停滞', '変化への恐怖', '抵抗'] }, meaning: { 'zh-TW': '可能表示你抗拒必要的結束，導致生活停滯不前。', 'en': 'May indicate you are resisting a necessary ending, causing your life to stagnate.', 'ja': 'あなたが必要な終わりを拒否し、人生が停滞していることを示している可能性があります。' } } },
            { id: 'major14', name: { 'zh-TW': '節制 (Temperance)', 'en': 'Temperance', 'ja': '節制 (Temperance)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=節制', upright: { keywords: { 'zh-TW': ['平衡', '和諧', '耐心'], 'en': ['Balance', 'Harmony', 'Patience'], 'ja': ['バランス', '調和', '忍耐'] }, meaning: { 'zh-TW': '代表尋求平衡與中庸之道，將不同力量融合在一起。', 'en': 'Represents seeking balance and the middle path, blending different forces together.', 'ja': 'バランスと中庸を求め、異なる力を融合させることを表します。' } }, reversed: { keywords: { 'zh-TW': ['失衡', '極端', '不和諧'], 'en': ['Imbalance', 'Extremes', 'Disharmony'], 'ja': ['不均衡', '極端', '不調和'] }, meaning: { 'zh-TW': '可能表示你缺乏耐心，或在某個方面過於極端。', 'en': 'May indicate you lack patience, or are being too extreme in some aspect.', 'ja': 'あなたが忍耐力を欠いている、または何らかの点で極端になっていることを示している可能性があります。' } } },
            { id: 'major15', name: { 'zh-TW': '惡魔 (The Devil)', 'en': 'The Devil', 'ja': '悪魔 (The Devil)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=惡魔', upright: { keywords: { 'zh-TW': ['誘惑', '束縛', '物質主義'], 'en': ['Temptation', 'Bondage', 'Materialism'], 'ja': ['誘惑', '束縛', '物質主義'] }, meaning: { 'zh-TW': '代表對物質慾望的沉迷，或被某些壞習慣所束縛。', 'en': 'Represents an obsession with material desires, or being bound by bad habits.', 'ja': '物質的な欲望への執着、または悪い習慣に縛られていることを表します。' } }, reversed: { keywords: { 'zh-TW': ['解脫', '覺醒', '擺脫束縛'], 'en': ['Liberation', 'Awakening', 'Breaking Free'], 'ja': ['解放', '覚醒', '束縛からの脱却'] }, meaning: { 'zh-TW': '可能表示你正意識到問題，並努力尋求自由。', 'en': 'May indicate you are becoming aware of the problem and are striving for freedom.', 'ja': 'あなたが問題に気づき、自由を求めて努力していることを示している可能性があります。' } } },
            { id: 'major16', name: { 'zh-TW': '高塔 (The Tower)', 'en': 'The Tower', 'ja': '塔 (The Tower)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=高塔', upright: { keywords: { 'zh-TW': ['破壞', '突變', '解放'], 'en': ['Destruction', 'Sudden Change', 'Liberation'], 'ja': ['破壊', '突然の変化', '解放'] }, meaning: { 'zh-TW': '代表突然的、劇烈的改變，破壞舊有結構以迎來新生。', 'en': 'Represents a sudden, drastic change, destroying old structures to welcome new life.', 'ja': '突然の、劇的な変化を表し、古い構造を破壊して新しい人生を歓迎します。' } }, reversed: { keywords: { 'zh-TW': ['恐懼改變', '延遲', '災難'], 'en': ['Fear of Change', 'Delay', 'Disaster'], 'ja': ['変化への恐怖', '遅延', '破滅'] }, meaning: { 'zh-TW': '可能表示你極力抗拒改變，最終導致更糟糕的後果。', 'en': 'May indicate you are fiercely resisting change, which ultimately leads to a worse outcome.', 'ja': 'あなたが変化に激しく抵抗し、最終的により悪い結果を招くことを示している可能性があります。' } } },
            { id: 'major17', name: { 'zh-TW': '星星 (The Star)', 'en': 'The Star', 'ja': '星 (The Star)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=星星', upright: { keywords: { 'zh-TW': ['希望', '靈感', '平靜'], 'en': ['Hope', 'Inspiration', 'Peace'], 'ja': ['希望', 'インスピレーション', '平和'] }, meaning: { 'zh-TW': '代表希望與靈感之光，在黑暗中帶來指引。', 'en': 'Represents a light of hope and inspiration, bringing guidance in the dark.', 'ja': '希望とインスピレーションの光を表し、暗闇の中で導きをもたらします。' } }, reversed: { keywords: { 'zh-TW': ['失望', '悲觀', '失去希望'], 'en': ['Disappointment', 'Pessimism', 'Loss of Hope'], 'ja': ['失望', '悲観', '希望の喪失'] }, meaning: { 'zh-TW': '可能表示你感到迷惘，或對未來失去信心。', 'en': 'May indicate you feel lost, or have lost faith in the future.', 'ja': 'あなたが迷っている、または未来への希望を失っていることを示している可能性があります。' } } },
            { id: 'major18', name: { 'zh-TW': '月亮 (The Moon)', 'en': 'The Moon', 'ja': '月 (The Moon)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=月亮', upright: { keywords: { 'zh-TW': ['幻覺', '潛意識', '未知'], 'en': ['Illusion', 'Subconscious', 'The Unknown'], 'ja': ['幻想', '潜在意識', '未知'] }, meaning: { 'zh-TW': '代表內心的不確定與恐懼，充滿隱藏的秘密。', 'en': 'Represents inner uncertainty and fear, full of hidden secrets.', 'ja': '内なる不確実性と恐怖を表し、隠された秘密に満ちています。' } }, reversed: { keywords: { 'zh-TW': ['困惑', '澄清', '揭露'], 'en': ['Confusion', 'Clarity', 'Revelation'], 'ja': ['混乱', '明確化', '暴露'] }, meaning: { 'zh-TW': '可能表示你正在努力看清真相，擺脫迷惘。', 'en': 'May indicate you are trying to see the truth clearly and break free from confusion.', 'ja': 'あなたが真実を明確に見ようと努力し、混乱から抜け出そうとしていることを示している可能性があります。' } } },
            { id: 'major19', name: { 'zh-TW': '太陽 (The Sun)', 'en': 'The Sun', 'ja': '太陽 (The Sun)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=太陽', upright: { keywords: { 'zh-TW': ['喜悅', '成功', '活力'], 'en': ['Joy', 'Success', 'Vitality'], 'ja': ['喜び', '成功', '活力'] }, meaning: { 'zh-TW': '代表光明、成功與喜悅，是所有美好事物的象徵。', 'en': 'Represents light, success, and joy, a symbol of all good things.', 'ja': '光、成功、そして喜びを表す、すべての良いことの象徴です。' } }, reversed: { keywords: { 'zh-TW': ['悲傷', '延遲', '缺乏活力'], 'en': ['Sadness', 'Delay', 'Lack of Vitality'], 'ja': ['悲しみ', '遅延', '活力不足'] }, meaning: { 'zh-TW': '可能表示快樂被延遲，或你正感到能量不足。', 'en': 'May indicate joy is delayed, or you are feeling a lack of energy.', 'ja': '喜びが遅れたり、活力が不足していると感じていることを示している可能性があります。' } } },
            { id: 'major20', name: { 'zh-TW': '審判 (Judgement)', 'en': 'Judgement', 'ja': '審判 (Judgement)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=審判', upright: { keywords: { 'zh-TW': ['覺醒', '審視', '重生'], 'en': ['Awakening', 'Review', 'Rebirth'], 'ja': ['覚醒', '再評価', '再生'] }, meaning: { 'zh-TW': '代表對過去的總結與審視，並為未來做出新的選擇。', 'en': 'Represents a review and summary of the past, and making new choices for the future.', 'ja': '過去の総括と再評価、そして未来のための新しい選択をすることを表します。' } }, reversed: { keywords: { 'zh-TW': ['自我懷疑', '拒絕', '延遲'], 'en': ['Self-doubt', 'Refusal', 'Delay'], 'ja': ['自己不信', '拒否', '遅延'] }, meaning: { 'zh-TW': '可能表示你正在逃避對自己的審視，或害怕做出決定。', 'en': 'May indicate you are avoiding self-reflection, or are afraid to make decisions.', 'ja': 'あなたが自己評価を避けている、または決断を下すことを恐れていることを示している可能性があります。' } } },
            { id: 'major21', name: { 'zh-TW': '世界 (The World)', 'en': 'The World', 'ja': '世界 (The World)' }, image: 'https://placehold.co/200x350/5D2828/FFFFFF?text=世界', upright: { keywords: { 'zh-TW': ['完成', '整合', '圓滿'], 'en': ['Completion', 'Integration', 'Fulfillment'], 'ja': ['完成', '統合', '満願'] }, meaning: { 'zh-TW': '代表一個週期的圓滿結束，達到目標並獲得完整的滿足感。', 'en': 'Represents the successful completion of a cycle, achieving goals and gaining a sense of fulfillment.', 'ja': '一つのサイクルの円満な終了を表し、目標を達成し、完全な満足感を得ます。' } }, reversed: { keywords: { 'zh-TW': ['未完成', '停滯', '阻礙'], 'en': ['Incompletion', 'Stagnation', 'Obstacles'], 'ja': ['未完成', '停滞', '障害'] }, meaning: { 'zh-TW': '可能表示項目未能完成，或感到被困住。', 'en': 'May indicate an incomplete project, or feeling stuck.', 'ja': 'プロジェクトが未完成である、または行き詰まりを感じていることを示している可能性があります。' } } },
        ];

        const tarotSpreads = [
            { id: 'three_card', name: { 'zh-TW': '三張牌牌陣', 'en': 'Three-Card Spread', 'ja': 'スリーカードスプレッド' }, description: { 'zh-TW': '這是最簡單的牌陣之一，通常用來快速回答一個問題。', 'en': 'One of the simplest spreads, used for quick answers to a question.', 'ja': '最もシンプルなスプレッドの一つで、質問に素早く答えるために使われます。' }, positions: [{ label: { 'zh-TW': '過去', 'en': 'Past', 'ja': '過去' }, meaning: { 'zh-TW': '代表影響你現況的過去事件或經歷。', 'en': 'Represents past events or experiences influencing your current situation.', 'ja': 'あなたの現状に影響を与えている過去の出来事や経験を表します。' } }, { label: { 'zh-TW': '現在', 'en': 'Present', 'ja': '現在' }, meaning: { 'zh-TW': '代表你目前所處的環境與狀態。', 'en': 'Represents your current environment and state.', 'ja': 'あなたが現在置かれている環境と状態を表します。' } }, { label: { 'zh-TW': '未來', 'en': 'Future', 'ja': '未来' }, meaning: { 'zh-TW': '代表短期內即將發生的事件或可能的趨勢。', 'en': 'Represents events or possible trends in the near future.', 'ja': '近い将来に起こるであろう出来事や傾向を表します。' } }] },
            { id: 'celtic_cross', name: { 'zh-TW': '凱爾特十字牌陣', 'en': 'Celtic Cross Spread', 'ja': 'ケルト十字スプレッド' }, description: { 'zh-TW': '這是一個能深度分析問題各個面向的綜合牌陣，適合處理複雜的問題。', 'en': 'A comprehensive spread for a deep analysis of a complex issue.', 'ja': '複雑な問題を深く分析するための包括的なスプレッドです。' }, positions: [{ label: { 'zh-TW': '現況', 'en': 'Current Situation', 'ja': '現状' }, meaning: { 'zh-TW': '代表你目前的狀況，是你問題的核心。', 'en': 'Represents your current situation, the core of your question.', 'ja': 'あなたの現状、質問の核心を表します。' } }, { label: { 'zh-TW': '挑戰', 'en': 'Challenge', 'ja': '挑戦' }, meaning: { 'zh-TW': '代表你所面臨的阻礙或困難。', 'en': 'Represents the obstacles or difficulties you face.', 'ja': 'あなたが直面している障害や困難を表します。' } }, { label: { 'zh-TW': '潛意識', 'en': 'Subconscious', 'ja': '潜在意識' }, meaning: { 'zh-TW': '代表你的潛意識或過去對你的影響。', 'en': 'Represents your subconscious or past influences on you.', 'ja': 'あなたの潜在意識や過去があなたに与える影響を表します。' } }, { label: { 'zh-TW': '未來', 'en': 'Future', 'ja': '未来' }, meaning: { 'zh-TW': '代表短期內即將發生的事件。', 'en': 'Represents events that will happen in the near future.', 'ja': '近い将来に起こる出来事を表します。' } }, { label: { 'zh-TW': '過去', 'en': 'Past', 'ja': '過去' }, meaning: { 'zh-TW': '代表你所處環境的過去影響。', 'en': 'Represents past influences on your environment.', 'ja': 'あなたの環境に対する過去の影響を表します。' } }, { label: { 'zh-TW': '潛在結果', 'en': 'Potential Outcome', 'ja': '潜在的な結果' }, meaning: { 'zh-TW': '代表你潛意識裡的目標或期望。', 'en': 'Represents your subconscious goals or expectations.', 'ja': 'あなたの潜在意識にある目標や期待を表します。' } }, { label: { 'zh-TW': '自我', 'en': 'Self', 'ja': '自己' }, meaning: { 'zh-TW': '代表你對自己的看法。', 'en': 'Represents your view of yourself.', 'ja': '自分自身に対するあなたの見方を表します。' } }, { label: { 'zh-TW': '外界', 'en': 'External Influence', 'ja': '外界' }, meaning: { 'zh-TW': '代表其他人或環境對你的影響。', 'en': 'Represents the influence of others or the environment on you.', 'ja': '他の人や環境があなたに与える影響を表します。' } }, { label: { 'zh-TW': '期望', 'en': 'Hopes & Fears', 'ja': '期待と恐れ' }, meaning: { 'zh-TW': '代表你對此問題的期望。', 'en': 'Represents your hopes and fears regarding this issue.', 'ja': 'この問題に関するあなたの期待と恐れを表します。' } }, { label: { 'zh-TW': '最終結果', 'en': 'Final Outcome', 'ja': '最終結果' }, meaning: { 'zh-TW': '代表此問題的最終走向。', 'en': 'Represents the final outcome of this issue.', 'ja': 'この問題の最終的な結末を表します。' } }] },
            { id: 'decision', name: { 'zh-TW': '二選一牌陣', 'en': 'Decision Spread', 'ja': '二者択一スプレッド' }, description: { 'zh-TW': '當你面臨兩個選擇時，這個牌陣能幫助你分析每個選項的優劣。', 'en': 'When you are facing two choices, this spread helps you analyze the pros and cons of each option.', 'ja': '二つの選択肢に直面している時、このスプレッドは各選択肢の長所と短所を分析するのに役立ちます。' }, positions: [{ label: { 'zh-TW': '選項一的優點', 'en': 'Pros of Option 1', 'ja': '選択肢1の利点' }, meaning: { 'zh-TW': '選擇選項一會帶來的好處。', 'en': 'The benefits of choosing option one.', 'ja': '選択肢1を選んだ場合に得られるメリット。' } }, { label: { 'zh-TW': '選項一的缺點', 'en': 'Cons of Option 1', 'ja': '選択肢1の欠点' }, meaning: { 'zh-TW': '選擇選項一會帶來的挑戰。', 'en': 'The challenges of choosing option one.', 'ja': '選択肢1を選んだ場合に直面するであろう課題。' } }, { label: { 'zh-TW': '選項二的優點', 'en': 'Pros of Option 2', 'ja': '選択肢2の利点' }, meaning: { 'zh-TW': '選擇選項二會帶來的好處。', 'en': 'The benefits of choosing option two.', 'ja': '選択肢2を選んだ場合に得られるメリット。' } }, { label: { 'zh-TW': '選項二的缺點', 'en': 'Cons of Option 2', 'ja': '選択肢2の欠点' }, meaning: { 'zh-TW': '選擇選項二會帶來的挑戰。', 'en': 'The challenges of choosing option two.', 'ja': '選択肢2を選んだ場合に直面するであろう課題。' } }, { label: { 'zh-TW': '建議', 'en': 'Advice', 'ja': 'アドバイス' }, meaning: { 'zh-TW': '塔羅牌給你的綜合建議。', 'en': 'The tarot cards\' comprehensive advice for you.', 'ja': 'タロットカードからの総合的なアドバイス。' } }] }
        ];
        
        // State management
        const app = document.getElementById('app');
        const cardModal = document.getElementById('card-modal');
        const feedbackModal = document.getElementById('feedback-modal');
        const state = {
            currentPage: 'home',
            currentLanguage: 'zh-TW',
            selectedSpread: null,
            deck: [],
            drawnCards: [],
            revealedCards: [],
            question: '',
            userInterpretation: '',
        };

        // Helper function to draw unique cards
        function drawUniqueCards(num) {
            const deck = [...tarotCards];
            const drawn = [];
            for (let i = 0; i < num; i++) {
                if (deck.length === 0) break;
                const randomIndex = Math.floor(Math.random() * deck.length);
                const card = deck.splice(randomIndex, 1)[0];
                const isReversed = Math.random() < 0.5;
                drawn.push({ ...card, isReversed });
            }
            return drawn;
        }
        
        // Get localized string
        function t(key) {
            return localizationData[state.currentLanguage][key] || key;
        }

        // Fix: Use document.execCommand for clipboard functionality
        function copyToClipboard(text) {
          const tempTextarea = document.createElement('textarea');
          tempTextarea.value = text;
          tempTextarea.style.position = 'fixed'; 
          tempTextarea.style.left = '-9999px';
          document.body.appendChild(tempTextarea);
          tempTextarea.select();
          tempTextarea.setSelectionRange(0, 99999);
          try {
            document.execCommand('copy');
            alert(t('copySuccess'));
          } catch (err) {
            console.error('無法複製到剪貼簿', err);
            alert(t('copyFail'));
          }
          document.body.removeChild(tempTextarea);
        }

        // --- RENDER FUNCTIONS ---

        function renderTopBar() {
            return `
                <div class="top-bar">
                    <select id="language-switcher" class="language-select">
                        <option value="zh-TW" ${state.currentLanguage === 'zh-TW' ? 'selected' : ''}>繁體中文</option>
                        <option value="en" ${state.currentLanguage === 'en' ? 'selected' : ''}>English</option>
                        <option value="ja" ${state.currentLanguage === 'ja' ? 'selected' : ''}>日本語</option>
                    </select>
                    <button id="feedback-button" class="button secondary">${t('feedbackButton')}</button>
                </div>
            `;
        }

        function renderHomePage() {
            app.innerHTML = `
                ${renderTopBar()}
                <div id="home-page" style="text-align: center; width: 100%;">
                    <h1>${t('homeTitle')}</h1>
                    <p>${t('homeIntro')}</p>
                    <div class="button-grid" style="margin-top: 2rem;">
                        <button class="button" id="start-reading-button">${t('startReading')}</button>
                        <button class="button secondary" id="browse-cards-button">${t('browseCards')}</button>
                    </div>
                    <div class="spreads-grid" style="margin-top: 3rem;">
                        ${tarotSpreads.map(spread => `
                            <div class="spread-card" data-id="${spread.id}" style="
                                display: flex; flex-direction: column; gap: 1rem; text-align: left;
                                background-color: var(--card-bg); padding: 1.5rem; border-radius: var(--border-radius);
                                box-shadow: var(--shadow-light); transition: all 0.3s ease; cursor: pointer;
                            ">
                                <h3>${spread.name[state.currentLanguage]}</h3>
                                <p>${spread.description[state.currentLanguage]}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            setupGlobalListeners();
            document.getElementById('start-reading-button').addEventListener('click', () => {
                state.currentPage = 'question';
                renderApp();
            });

            document.getElementById('browse-cards-button').addEventListener('click', () => {
                state.currentPage = 'browse';
                renderApp();
            });
            
            app.querySelectorAll('.spread-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const spreadId = e.currentTarget.dataset.id;
                    state.selectedSpread = tarotSpreads.find(s => s.id === spreadId);
                    state.currentPage = 'question';
                    renderApp();
                });
            });
        }
        
        function renderQuestionPage() {
            if (!state.selectedSpread) {
                renderHomePage();
                return;
            }

            app.innerHTML = `
                ${renderTopBar()}
                <div class="page-header">
                    <button class="button secondary" id="back-button">${t('back')}</button>
                    <h2>${state.selectedSpread.name[state.currentLanguage]}</h2>
                    <div></div>
                </div>
                <h3>${t('questionTitle')}</h3>
                <p>${t('questionIntro')}</p>
                <input type="text" id="question-input" placeholder="${t('questionPlaceholder')}" value="${state.question}">
                <button class="button" id="start-draw-button" style="margin-top: 1.5rem;">${t('startDraw')}</button>
            `;

            setupGlobalListeners();
            document.getElementById('back-button').addEventListener('click', () => {
                state.currentPage = 'home';
                renderApp();
            });
            
            const questionInput = document.getElementById('question-input');
            questionInput.addEventListener('input', (e) => {
                state.question = e.target.value;
            });

            document.getElementById('start-draw-button').addEventListener('click', () => {
                if (state.question.trim() === '') {
                    alert(t('questionPlaceholder'));
                    return;
                }
                state.drawnCards = drawUniqueCards(state.selectedSpread.positions.length);
                state.revealedCards = Array(state.selectedSpread.positions.length).fill(false);
                state.userInterpretation = '';
                state.currentPage = 'reading';
                renderApp();
            });
        }

        function renderReadingPage() {
            if (!state.selectedSpread || state.drawnCards.length === 0) {
                renderHomePage();
                return;
            }

            app.innerHTML = `
                ${renderTopBar()}
                <div class="page-header">
                    <button class="button secondary" id="back-to-question-button">${t('back')}</button>
                    <h2>${state.selectedSpread.name[state.currentLanguage]}</h2>
                    <button class="button" id="shuffle-button">${t('shuffle')}</button>
                </div>
                <div id="reading-page" style="width: 100%; display: flex; flex-direction: column; align-items: center; gap: 2rem;">
                    <h3>${t('yourQuestion')} ${state.question}</h3>
                    <p>${t('readingIntro')}</p>
                    <div class="spread-positions">
                        ${state.selectedSpread.positions.map((pos, index) => {
                            const drawnCard = state.drawnCards[index];
                            const isRevealed = state.revealedCards[index];
                            const cardMeaning = drawnCard.isReversed ? drawnCard.reversed : drawnCard.upright;
                            
                            return `
                                <div class="position-item">
                                    <div class="position-number">
                                        <div class="card-container" data-index="${index}">
                                            <div class="card-inner ${isRevealed ? 'is-flipped' : ''}">
                                                <div class="card-face card-back"></div>
                                                <div class="card-face card-front" style="
                                                    background-image: url('${drawnCard.image}'); 
                                                    transform: rotate(${drawnCard.isReversed ? '180deg' : '0deg'});
                                                "></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="position-details">
                                        <h4>${pos.label[state.currentLanguage]}</h4>
                                        <p><strong>${t('positionMeaning')}：</strong>${pos.meaning[state.currentLanguage]}</p>
                                        ${isRevealed ? `
                                            <div class="card-meaning-info">
                                                <h5>${drawnCard.name[state.currentLanguage]} (${drawnCard.isReversed ? t('reversed') : t('upright')})</h5>
                                                <p><strong>${t('keywords')}：</strong>${cardMeaning.keywords[state.currentLanguage].join('、')}</p>
                                                <p>${cardMeaning.meaning[state.currentLanguage]}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div id="interpretation-section" style="display: ${state.revealedCards.every(r => r) ? 'block' : 'none'};">
                        <h3>${t('interpretationTitle')}</h3>
                        <p>${t('notesIntro')}</p>
                        <textarea id="user-notes-input" placeholder="${t('notesPlaceholder')}">${state.userInterpretation}</textarea>
                        <div class="share-button-container">
                            <button class="button" id="share-button">${t('copyShare')}</button>
                        </div>
                    </div>
                </div>
            `;
            
            setupGlobalListeners();
            document.getElementById('back-to-question-button').addEventListener('click', () => {
                state.currentPage = 'question';
                renderApp();
            });

            document.getElementById('shuffle-button').addEventListener('click', () => {
                state.drawnCards = drawUniqueCards(state.selectedSpread.positions.length);
                state.revealedCards = Array(state.selectedSpread.positions.length).fill(false);
                state.userInterpretation = '';
                renderApp();
            });

            app.querySelectorAll('.card-container').forEach(card => {
                card.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    if (!state.revealedCards[index]) {
                        state.revealedCards[index] = true;
                        renderApp();
                    }
                });
            });

            const notesInput = document.getElementById('user-notes-input');
            if (notesInput) {
                notesInput.addEventListener('input', (e) => {
                    state.userInterpretation = e.target.value;
                });
                
                document.getElementById('share-button').addEventListener('click', () => {
                    const readingText = `
${t('yourQuestion')} ${state.question}
${t('appTitle')} - ${state.selectedSpread.name[state.currentLanguage]}

--- ${t('interpretationTitle')} ---
${state.drawnCards.map((card, index) => {
    const pos = state.selectedSpread.positions[index];
    const cardMeaning = card.isReversed ? card.reversed : card.upright;
    return `
${index + 1}. ${pos.label[state.currentLanguage]}：${card.name[state.currentLanguage]} (${card.isReversed ? t('reversed') : t('upright')})
   - ${t('keywords')}：${cardMeaning.keywords[state.currentLanguage].join('、')}
   - ${t('meaning')}：${cardMeaning.meaning[state.currentLanguage]}`;
}).join('\n\n')}

--- ${t('notesIntro')} ---
${state.userInterpretation || '（尚無筆記）'}
                    `;
                    
                    copyToClipboard(readingText);
                });
            }
        }

        function renderAllCardsPage() {
            app.innerHTML = `
                ${renderTopBar()}
                <div class="page-header">
                    <button class="button secondary" id="back-button">${t('back')}</button>
                    <h2>${t('browseAllCardsTitle')}</h2>
                    <div></div>
                </div>
                <p>${t('browseIntro')}</p>
                <div class="card-grid">
                    ${tarotCards.map(card => `
                        <div class="card-item" data-id="${card.id}">
                            <img src="${card.image}" alt="${card.name[state.currentLanguage]}">
                            <h5>${card.name[state.currentLanguage]}</h5>
                        </div>
                    `).join('')}
                </div>
            `;
            
            setupGlobalListeners();
            document.getElementById('back-button').addEventListener('click', () => {
                state.currentPage = 'home';
                renderApp();
            });

            app.querySelectorAll('.card-item').forEach(cardItem => {
                cardItem.addEventListener('click', (e) => {
                    const cardId = e.currentTarget.dataset.id;
                    const card = tarotCards.find(c => c.id === cardId);
                    if (card) {
                        showCardDetails(card);
                    }
                });
            });
        }
        
        function showCardDetails(card) {
            const modalContent = document.getElementById('modal-content-inner');
            modalContent.innerHTML = `
                <h3 style="text-align: center;">${card.name[state.currentLanguage]}</h3>
                <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                    <img src="${card.image}" alt="${card.name[state.currentLanguage]}" style="width: 150px; border-radius: 8px;">
                </div>
                <h4>${t('upright')}</h4>
                <p><strong>${t('keywords')}：</strong> ${card.upright.keywords[state.currentLanguage].join('、')}</p>
                <p>${card.upright.meaning[state.currentLanguage]}</p>
                <hr style="border: none; border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 1.5rem 0;">
                <h4>${t('reversed')}</h4>
                <p><strong>${t('keywords')}：</strong> ${card.reversed.keywords[state.currentLanguage].join('、')}</p>
                <p>${card.reversed.meaning[state.currentLanguage]}</p>
            `;
            cardModal.style.display = 'flex';
        }
        
        function showFeedbackModal() {
            const feedbackTitle = feedbackModal.querySelector('h3');
            const feedbackSubmitButton = feedbackModal.querySelector('#feedback-form button');
            const feedbackEmailInput = feedbackModal.querySelector('#feedback-email');
            const feedbackTextInput = feedbackModal.querySelector('#feedback-text');

            feedbackTitle.textContent = t('feedbackTitle');
            feedbackSubmitButton.textContent = t('feedbackSubmit');
            feedbackEmailInput.placeholder = t('feedbackEmailPlaceholder');
            feedbackTextInput.placeholder = t('feedbackTextPlaceholder');
            
            feedbackModal.style.display = 'flex';
        }
        
        // Main Render Loop
        function renderApp() {
            switch (state.currentPage) {
                case 'home':
                    renderHomePage();
                    break;
                case 'question':
                    renderQuestionPage();
                    break;
                case 'reading':
                    renderReadingPage();
                    break;
                case 'browse':
                    renderAllCardsPage();
                    break;
                default:
                    renderHomePage();
            }
        }
        
        // Setup listeners that persist across page renders
        function setupGlobalListeners() {
            // Language Switcher
            const langSwitcher = document.getElementById('language-switcher');
            if (langSwitcher) {
                langSwitcher.addEventListener('change', (e) => {
                    state.currentLanguage = e.target.value;
                    renderApp();
                });
            }

            // Feedback button
            const feedbackButton = document.getElementById('feedback-button');
            if (feedbackButton) {
                feedbackButton.addEventListener('click', showFeedbackModal);
            }
        }
        
        // --- EVENT LISTENERS FOR MODALS ---
        cardModal.querySelector('.modal-close').addEventListener('click', () => {
            cardModal.style.display = 'none';
        });
        window.addEventListener('click', (e) => {
            if (e.target === cardModal) {
                cardModal.style.display = 'none';
            }
        });

        feedbackModal.querySelector('.modal-close').addEventListener('click', () => {
            feedbackModal.style.display = 'none';
        });
        window.addEventListener('click', (e) => {
            if (e.target === feedbackModal) {
                feedbackModal.style.display = 'none';
            }
        });

        document.getElementById('feedback-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('feedback-email').value;
            const text = document.getElementById('feedback-text').value;
            
            console.log('Feedback Submitted:', { email, text });
            
            alert(t('feedbackSuccess'));
            
            feedbackModal.style.display = 'none';
            document.getElementById('feedback-email').value = '';
            document.getElementById('feedback-text').value = '';
        });

        // App Initialization
        window.onload = renderApp;
    </script>
</body>
</html>
