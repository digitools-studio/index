<!DOCTYPE html>
<html lang="zh-Hant">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">

<head>
    <title>çµ‚æ¥µå¯†ç¢¼çŒœè¬ï½œæ•¸ä½é‡‘åº«å…¥ä¾µæ¨¡æ“¬ï¼ˆä¸å«é‚Šç•Œè¦å‰‡ï¼‰| Guess The Number</title>
    <meta name="description" content="ç¶“å…¸ã€çµ‚æ¥µå¯†ç¢¼ã€è¦å‰‡ï¼ˆä¸å«é‚Šç•Œï¼‰ï¼Œåœ¨é™å®šå›åˆä¸­ç ´è§£æ•¸ä½é‡‘åº«ã€‚æ”¯æ´ä¸­è‹±æ—¥ã€é›£åº¦èˆ‡è‡ªè¨‚ç¯„åœï¼Œé©åˆé‚è¼¯æ¨ç†èˆ‡å¿ƒæ™ºè¨“ç·´ã€‚">

    <link rel="canonical" href="https://example.com/vault-guess" />
    <link rel="alternate" href="https://example.com/vault-guess" hreflang="zh-Hant" />
    <link rel="alternate" href="https://example.com/vault-guess?lang=en" hreflang="en" />
    <link rel="alternate" href="https://example.com/vault-guess?lang=ja" hreflang="ja" />
    <meta name="robots" content="index,follow,max-image-preview:large" />

    <meta property="og:type" content="website">
    <meta property="og:title" content="çµ‚æ¥µå¯†ç¢¼çŒœè¬ï½œæ•¸ä½é‡‘åº«å…¥ä¾µæ¨¡æ“¬ï¼ˆä¸å«é‚Šç•Œï¼‰">
    <meta property="og:description" content="åœ¨é™å®šå›åˆå…§ç ´è§£é‡‘åº«å¯†ç¢¼ã€‚æ”¯æ´ä¸­è‹±æ—¥ã€è‡ªè¨‚é›£åº¦èˆ‡ç¯„åœã€‚">
    <meta property="og:url" content="https://example.com/vault-guess">
    <meta property="og:image" content="https://example.com/assets/og-vault-guess.png">
    <meta property="og:locale" content="zh_TW">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="çµ‚æ¥µå¯†ç¢¼çŒœè¬ï½œæ•¸ä½é‡‘åº«å…¥ä¾µæ¨¡æ“¬">
    <meta name="twitter:description" content="ä¸å«é‚Šç•Œè¦å‰‡çš„ç¶“å…¸çŒœæ•¸å­—ã€‚ä¸­è‹±æ—¥èˆ‡è‡ªè¨‚é›£åº¦ã€‚">
    <meta name="twitter:image" content="https://example.com/assets/og-vault-guess.png">
    
    <!-- è¼‰å…¥ Tailwind CSS CDN (ç”¨æ–¼ç‚«é…·çš„éŸ¿æ‡‰å¼è¨­è¨ˆ) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Vue.js 3 CDN -->
    <!-- å¼•å…¥ nextTick å‡½å¼ä»¥ç®¡ç†ç„¦é» -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«”ä»¥æé«˜ç¾ä»£æ„Ÿå’Œå¯è®€æ€§ */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* é»‘æš—èƒŒæ™¯ */
        }
        /* éš±è— Chrome/Safari çš„æ•¸å­—è¼¸å…¥ä¸Šä¸‹ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* éš±è— Firefox çš„æ•¸å­—è¼¸å…¥ä¸Šä¸‹ç®­é ­ */
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* è®“é¸é …å¡çœ‹èµ·ä¾†æ›´åƒç§‘æŠ€ä»‹é¢ */
        .tab-button {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen p-4 sm:p-8 flex items-center justify-center">
    <div class="w-full max-w-4xl bg-gray-800 p-6 sm:p-10 rounded-3xl shadow-2xl border border-gray-700">

        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-teal-400 mb-2">{{ t.title }}</h1>
            <p class="text-lg text-gray-400 mb-6">
                {{ translate(t.subtitle, minRange, maxRange) }}
            </p>
            
            <div class="flex justify-center space-x-3 mb-6">
                <span class="text-gray-400 mr-2 self-center">{{ t.language }}:</span>
                <button
                    @click="changeLanguage('zh')"
                    :class="{'bg-teal-600 ring-2 ring-teal-400': language === 'zh', 'bg-gray-600 hover:bg-teal-700': language !== 'zh'}"
                    class="px-3 py-1 text-sm font-semibold text-white rounded-full transition duration-200 shadow-lg"
                >
                    ç¹é«”ä¸­æ–‡
                </button>
                <button
                    @click="changeLanguage('en')"
                    :class="{'bg-teal-600 ring-2 ring-teal-400': language === 'en', 'bg-gray-600 hover:bg-teal-700': language !== 'en'}"
                    class="px-3 py-1 text-sm font-semibold text-white rounded-full transition duration-200 shadow-lg"
                >
                    English
                </button>
                <button
                    @click="changeLanguage('jp')"
                    :class="{'bg-teal-600 ring-2 ring-teal-400': language === 'jp', 'bg-gray-600 hover:bg-teal-700': language !== 'jp'}"
                    class="px-3 py-1 text-sm font-semibold text-white rounded-full transition duration-200 shadow-lg"
                >
                    æ—¥æœ¬èª
                </button>
            </div>
        </header>

        <div class="bg-gray-900 p-5 rounded-2xl mb-8 border border-teal-500/30 shadow-2xl">
            <h2 class="text-2xl font-bold text-teal-300 mb-4 border-b border-gray-700 pb-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37h.001z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                {{ t.header_config }}
            </h2>
            
            <div class="flex flex-wrap gap-2 mb-4">
                <button
                    v-for="(mode, key) in gameModes"
                    :key="key"
                    @click="setGameMode(key)"
                    :class="{
                        'bg-teal-600 ring-2 ring-teal-400': gameModeKey === key,
                        'bg-gray-700 hover:bg-gray-600': gameModeKey !== key
                    }"
                    class="tab-button px-4 py-2 text-sm font-semibold text-white rounded-lg shadow-md flex-grow sm:flex-grow-0"
                >
                    {{ t[mode.nameKey] }}
                </button>
            </div>

            <div class="p-4 bg-gray-700/50 rounded-xl">
                <p v-if="gameModeKey !== 'custom'" class="text-sm text-gray-300 mb-3">
                    {{ translate(t.config_info, t[gameModes[gameModeKey].nameKey], gameModes[gameModeKey].min, gameModes[gameModeKey].max, gameModes[gameModeKey].attempts) }}
                </p>

                <div v-else class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="col-span-1 md:col-span-2">
                        <label class="block text-gray-400 text-sm mb-1">{{ t.config_range }}</label>
                        <div class="flex space-x-2">
                            <input type="number" v-model.number="customMin" min="1" max="999" class="p-2 w-1/2 bg-gray-600 text-white rounded-lg focus:ring-teal-500 focus:outline-none">
                            <span class="self-center text-gray-300">-</span>
                            <input type="number" v-model.number="customMax" :min="customMin + 1" max="10000" class="p-2 w-1/2 bg-gray-600 text-white rounded-lg focus:ring-teal-500 focus:outline-none">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">{{ t.config_attempts }}</label>
                        <input type="number" v-model.number="customAttempts" min="1" max="50" class="p-2 w-full bg-gray-600 text-white rounded-lg focus:ring-teal-500 focus:outline-none">
                    </div>
                </div>
            </div>

            <button
                @click="startGame"
                class="mt-4 w-full px-6 py-3 text-white font-bold rounded-xl shadow-lg transform transition duration-300 ease-in-out"
                :class="{
                    'bg-red-500 hover:bg-red-600 shadow-red-500/50': gameStatus === 'playing',
                    'bg-blue-500 hover:bg-blue-600 shadow-blue-500/50': gameStatus !== 'playing'
                }"
            >
                {{ gameStatus === 'playing' ? t.restart_game : t.start_game }}
            </button>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8 text-center">
            <div class="p-4 bg-gray-700 rounded-xl shadow-inner border border-gray-600">
                <p class="text-gray-400 text-sm">{{ t.current_mode }}</p>
                <p class="text-xl font-bold text-yellow-300">{{ t[gameModes[gameModeKey].nameKey] }}</p>
            </div>
            <div class="p-4 bg-gray-700 rounded-xl shadow-inner border border-gray-600">
                <p class="text-gray-400 text-sm">{{ t.attempt }}</p>
                <p class="text-2xl font-bold text-teal-300">{{ currentAttempts }} / {{ maxAttempts }}</p>
            </div>
            <div class="p-4 bg-gray-700 rounded-xl shadow-inner border border-gray-600">
                <p class="text-gray-400 text-sm">{{ t.high_score }}</p>
                <p class="text-2xl font-bold text-yellow-300">{{ highScore !== null ? translate(t.attempt) + ' ' + highScore : 'N/A' }}</p>
            </div>
        </div>

        <div class="bg-gray-700 p-6 rounded-2xl mb-8 shadow-xl border border-gray-600">
            <p 
                :class="{
                    'text-green-400 animate-pulse': gameStatus === 'won',
                    'text-red-400': gameStatus === 'lost',
                    'text-blue-400': gameStatus === 'playing'
                }"
                class="text-xl font-semibold text-center mb-4 transition-colors duration-500"
            >
                {{ gameMessage }}
            </p>

            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                <input
                    ref="guessInputRef" 
                    type="number"
                    v-model.number="guess"
                    :placeholder="translate(t.input_placeholder, minRange, maxRange)"
                    :disabled="gameStatus !== 'playing'"
                    @keyup.enter="gameStatus === 'playing' ? makeGuess() : startGame()"
                    @input="isInputInvalid = false" 
                    class="flex-grow p-3 bg-gray-600 text-white rounded-xl focus:ring-2 focus:ring-teal-500 focus:outline-none placeholder-gray-400 transition text-center"
                    :class="{'border-2 border-red-500 ring-4 ring-red-500/50': isInputInvalid}" 
                >
                <button
                    @click="gameStatus === 'playing' ? makeGuess() : startGame()"
                    :disabled="gameStatus !== 'playing'"
                    :class="{
                        'bg-teal-500 hover:bg-teal-600 shadow-teal-500/50': gameStatus === 'playing',
                        'bg-blue-500 hover:bg-blue-600 shadow-blue-500/50': gameStatus !== 'playing',
                        'opacity-60 cursor-not-allowed': gameStatus !== 'playing'
                    }"
                    class="w-full sm:w-auto px-6 py-3 text-white font-bold rounded-xl shadow-lg transform transition duration-300 ease-in-out hover:scale-[1.02]"
                >
                    {{ gameStatus === 'playing' ? t.guess_button : t.start_game }}
                </button>
            </div>
        </div>

        <div v-if="guesses.length > 0" class="mt-8 bg-gray-800 p-4 sm:p-6 rounded-2xl border border-gray-700">
            <h3 class="text-2xl font-bold text-gray-300 mb-4 border-b border-gray-600 pb-2">
                {{ t.header_guess }} / {{ t.header_result }}
            </h3>
            <div class="max-h-64 overflow-y-auto pr-2">
                <transition-group name="list" tag="ul">
                    <li v-for="(item, index) in guesses" :key="index"
                        class="flex justify-between items-center p-3 mb-2 rounded-lg transition-all duration-300"
                        :class="{
                        'bg-gray-700/50': index % 2 === 0,
                        'bg-gray-700': index % 2 !== 0,
                        'border-l-4 border-teal-500': item.min !== minRange || item.max !== maxRange
                        }"
                    >
                        <span class="text-xl font-mono text-white w-1/4">
                            {{ item.value }}
                        </span>
                        <span class="text-gray-300 w-3/4 text-right sm:text-left">
                            {{ item.hint }}
                        </span>
                    </li>
                </transition-group>
            </div>
        </div>

    </div>
</div>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": ["SoftwareApplication","Game"],
  "name": "çµ‚æ¥µå¯†ç¢¼çŒœè¬ï½œæ•¸ä½é‡‘åº«å…¥ä¾µæ¨¡æ“¬",
  "alternateName": ["Guess The Number","Digital Vault Breach Simulator"],
  "applicationCategory": "Game",
  "operatingSystem": "Web",
  "inLanguage": ["zh-Hant","en","ja"],
  "description": "ç¶“å…¸çµ‚æ¥µå¯†ç¢¼ï¼ˆä¸å«é‚Šç•Œï¼‰è¦å‰‡ï¼Œé™å®šå›åˆç ´è§£æ•¸ä½é‡‘åº«ã€‚æ”¯æ´å¤šèªè¨€èˆ‡è‡ªè¨‚é›£åº¦ã€‚",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "TWD" },
  "url": "https://example.com/vault-guess",
  "image": "https://example.com/assets/og-vault-guess.png",
  "genre": ["Puzzle","Logic"],
  "keywords": "çµ‚æ¥µå¯†ç¢¼, çŒœæ•¸å­—, é‚è¼¯éŠæˆ², çŒœæ•¸å­—éŠæˆ², Guess The Number"
}
</script>

<script>
    // å¼•å…¥ nextTick å‡½å¼
    const { createApp, ref, computed, watch, nextTick } = Vue;

    // --- éŠæˆ²æ¨¡å¼é…ç½® ---
    const gameModesConfig = {
        novice_hacker: { // æ–°æ‰‹é§­å®¢
            min: 1, max: 50, attempts: 10, nameKey: 'mode_novice'
        },
        elite_codebreaker: { // ç²¾è‹±å¯†ç¢¼è§£è­¯å“¡ (æ¨™æº–)
            min: 1, max: 100, attempts: 10, nameKey: 'mode_elite'
        },
        ai_guardian: { // AI å®ˆè­·è€… (å°ˆå®¶)
            min: 1, max: 1000, attempts: 15, nameKey: 'mode_ai_guardian'
        },
        custom: { // è‡ªè¨‚æ¨¡å¼
            min: 1, max: 100, attempts: 10, nameKey: 'mode_custom'
        }
    };

    // --- åœ‹éš›åŒ– (i18n) å­—å…¸ ---
    const translations = {
        zh: {
            title: 'ğŸ’ æ•¸ä½é‡‘åº«å…¥ä¾µæ¨¡æ“¬',
            subtitle: 'ç•¶å‰é‡‘åº«å¯†ç¢¼ç¯„åœï¼š$0 åˆ° $1ï¼ˆä¸å«é‚Šç•Œï¼‰',
            start_game: 'é–‹å§‹å…¥ä¾µ (æ–°éŠæˆ²)',
            restart_game: 'é‡å•Ÿå…¥ä¾µ (é‡è¨­å¯†ç¢¼)',
            guess_button: 'çŒœæ¸¬',
            input_placeholder: 'è«‹è¼¸å…¥ä»‹æ–¼ $0 èˆ‡ $1 ä¹‹é–“ï¼ˆä¸å«ï¼‰çš„æ•¸å­—',
            attempt: 'ç•¶å‰å›åˆ',
            attempts_remaining: 'å‰©é¤˜æ¬¡æ•¸',
            high_score: 'æœ€ä½³ç´€éŒ„ (æœ€å°‘å˜—è©¦)',
            current_mode: 'ç•¶å‰æ¨¡å¼',
            status_playing: 'å…¥ä¾µé€²è¡Œä¸­... å°‹æ‰¾æ­£ç¢ºçš„é »ç‡ã€‚',
            status_win: 'å…¥ä¾µæˆåŠŸï¼é‡‘åº«å¯†ç¢¼å·²è¢«ç ´è§£ï¼ğŸ‰',
            status_loss: 'å…¥ä¾µå¤±æ•—ï¼Œè­¦å ±å·²å•Ÿå‹•ã€‚å¯†ç¢¼æ˜¯ $0',
            hint_too_low: 'çŒœæ¸¬æ•¸å­—å¤ªä½ï¼Œæ–°ç¯„åœï¼š',
            hint_too_high: 'çŒœæ¸¬æ•¸å­—å¤ªé«˜ï¼Œæ–°ç¯„åœï¼š',
            error_invalid: 'è«‹è¼¸å…¥ä¸€å€‹æœ‰æ•ˆçš„æ•¸å­—ã€‚',
            error_range: 'è«‹è¼¸å…¥ä»‹æ–¼ $0 èˆ‡ $1 ä¹‹é–“ï¼ˆä¸å«ï¼‰çš„æ•¸å­—ã€‚',
            header_guess: 'å˜—è©¦å€¼',
            header_result: 'é‡‘åº«æç¤º',
            language: 'èªè¨€',
            header_config: 'âš™ï¸ å…¥ä¾µé…ç½®èˆ‡é›£åº¦é¸æ“‡',
            mode_novice: 'æ–°æ‰‹é§­å®¢',
            mode_elite: 'ç²¾è‹±å¯†ç¢¼è§£è­¯å“¡',
            mode_ai_guardian: 'AI å®ˆè­·è€…',
            mode_custom: 'è‡ªè¨‚é…ç½®',
            config_range: 'å¯†ç¢¼æ•¸å­—ç¯„åœ',
            config_attempts: 'æœ€å¤§å˜—è©¦æ¬¡æ•¸',
            config_info: 'é¸æ“‡ $0 æ¨¡å¼ï¼šå¯†ç¢¼ç¯„åœ $1 åˆ° $2ï¼Œç¸½å…± $3 æ¬¡å˜—è©¦æ©Ÿæœƒã€‚',
        },
        en: {
            title: 'ğŸ’ Digital Vault Breach Simulator',
            subtitle: 'Current vault code range: $0 to $1 (exclusive)',
            start_game: 'Start Breach (New Game)',
            restart_game: 'Restart Breach (New Code)',
            guess_button: 'Guess',
            input_placeholder: 'Enter a number strictly between $0 and $1',
            attempt: 'Current Attempt',
            attempts_remaining: 'Attempts Remaining',
            high_score: 'High Score (Least Attempts)',
            current_mode: 'Current Mode',
            status_playing: 'Breach in progress... Finding the right frequency.',
            status_win: 'Breach Successful! Vault code cracked! ğŸ‰',
            status_loss: 'Breach Failed. Alarm triggered. The code was $0',
            hint_too_low: 'Guess was too low. New range:',
            hint_too_high: 'Guess was too high. New range:',
            error_invalid: 'Please enter a valid number.',
            error_range: 'Please enter a number strictly between $0 and $1.',
            header_guess: 'Guess',
            header_result: 'Vault Hint',
            language: 'Language',
            header_config: 'âš™ï¸ Breach Configuration & Role Selection',
            mode_novice: 'Novice Hacker',
            mode_elite: 'Elite Codebreaker',
            mode_ai_guardian: 'AI Guardian',
            mode_custom: 'Custom Configuration',
            config_range: 'Code Number Range',
            config_attempts: 'Max Attempts',
            config_info: 'You selected the $0 mode: Code range $1 to $2, with $3 total attempts.',
        },
        jp: {
            title: 'ç¾åœ¨ã®é‡‘åº«ã‚³ãƒ¼ãƒ‰ç¯„å›²ï¼š$0 ã‹ã‚‰ $1ï¼ˆç«¯ç‚¹ã‚’å«ã¾ãªã„ï¼‰',
            subtitle: 'ç¾åœ¨ã®é‡‘åº«ã‚³ãƒ¼ãƒ‰ç¯„å›²ï¼š$0 ã‹ã‚‰ $1',
            start_game: 'ä¾µå…¥é–‹å§‹ (æ–°è¦ã‚²ãƒ¼ãƒ )',
            restart_game: 'ä¾µå…¥å†é–‹ (ã‚³ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ)',
            guess_button: 'æ¨æ¸¬',
            input_placeholder: '$0 ã¨ $1 ã®é–“ï¼ˆç«¯ç‚¹å«ã¾ãšï¼‰ã®æ•°å­—ã‚’å…¥åŠ›',
            attempt: 'ç¾åœ¨ã®è©¦è¡Œ',
            attempts_remaining: 'æ®‹ã‚Šå›æ•°',
            high_score: 'ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ (æœ€å°‘è©¦è¡Œ)',
            current_mode: 'ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰',
            status_playing: 'ä¾µå…¥é€²è¡Œä¸­... æ­£ã—ã„å‘¨æ³¢æ•°ã‚’æ¢ã—ã¦ã„ã¾ã™ã€‚',
            status_win: 'ä¾µå…¥æˆåŠŸï¼é‡‘åº«ã‚³ãƒ¼ãƒ‰ãŒè§£èª­ã•ã‚Œã¾ã—ãŸï¼ğŸ‰',
            status_loss: 'ä¾µå…¥å¤±æ•—ã€‚ã‚¢ãƒ©ãƒ¼ãƒ ãŒä½œå‹•ã—ã¾ã—ãŸã€‚ã‚³ãƒ¼ãƒ‰ã¯ $0 ã§ã—ãŸ',
            hint_too_low: 'æ¨æ¸¬ãŒä½ã™ãã¾ã™ã€‚æ–°ã—ã„ç¯„å›²:',
            hint_too_high: 'æ¨æ¸¬ãŒé«˜ã™ãã¾ã™ã€‚æ–°ã—ã„ç¯„å›²:',
            error_invalid: 'æœ‰åŠ¹ãªæ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
            error_range: '$0 ã¨ $1 ã®é–“ï¼ˆç«¯ç‚¹å«ã¾ãšï¼‰ã®æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚',
            header_guess: 'æ¨æ¸¬å€¤',
            header_result: 'é‡‘åº«ãƒ’ãƒ³ãƒˆ',
            language: 'è¨€èª',
            header_config: 'âš™ï¸ ä¾µå…¥è¨­å®šã¨å½¹å‰²é¸æŠ',
            mode_novice: 'åˆå¿ƒè€…ãƒãƒƒã‚«ãƒ¼',
            mode_elite: 'ã‚¨ãƒªãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼',
            mode_ai_guardian: 'AI ã‚¬ãƒ¼ãƒ‡ã‚£ã‚¢ãƒ³',
            mode_custom: 'ã‚«ã‚¹ã‚¿ãƒ è¨­å®š',
            config_range: 'ã‚³ãƒ¼ãƒ‰æ•°å­—ã®ç¯„å›²',
            config_attempts: 'æœ€å¤§è©¦è¡Œå›æ•°',
            config_info: '$0 ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¾ã—ãŸï¼šã‚³ãƒ¼ãƒ‰ç¯„å›²ã¯ $1 ã‹ã‚‰ $2ã€åˆè¨ˆ $3 å›ã®è©¦è¡Œæ©Ÿä¼šãŒã‚ã‚Šã¾ã™ã€‚',
        }
    };

    // Helper å‡½æ•¸ï¼šç”¨æ–¼æ›¿æ›ç¿»è­¯å­—ä¸²ä¸­çš„ $0, $1 ç­‰è®Šæ•¸
    const translate = (str, ...args) => {
        return String(str || '').replace(/\$(\d+)/g, (_, i) => {
            const v = args[Number(i)];
            return (v === undefined || v === null) ? _ : String(v);
        });
        };

    createApp({
        setup() {
            // --- ç‹€æ…‹æ•¸æ“š ---
            const localStorageKey = 'ultimate_code_state_v2';
            
            // UX å„ªåŒ– 1 & 2: ç”¨æ–¼æ§åˆ¶ç„¦é»å’Œè¼¸å…¥éŒ¯èª¤çš„éŸ¿æ‡‰å¼è®Šæ•¸
            const guessInputRef = ref(null); // è¼¸å…¥æ¡†çš„ DOM å¼•ç”¨
            const isInputInvalid = ref(false); // è¼¸å…¥éŒ¯èª¤ç‹€æ…‹

            // éŠæˆ²é…ç½®ç‹€æ…‹
            const gameModeKey = ref('elite_codebreaker'); // æ±ºå®šç•¶å‰æ¨¡å¼
            const initialMin = ref(gameModesConfig.elite_codebreaker.min);
            const initialMax = ref(gameModesConfig.elite_codebreaker.max);
            const maxAttempts = ref(gameModesConfig.elite_codebreaker.attempts);

            // è‡ªè¨‚æ¨¡å¼çš„è‡¨æ™‚è¼¸å…¥
            const customMin = ref(1);
            const customMax = ref(100);
            const customAttempts = ref(10);

            // éŠæˆ²é€²è¡Œç‹€æ…‹
            const secretNumber = ref(0);
            const minRange = ref(initialMin.value);
            const maxRange = ref(initialMax.value);
            const guess = ref(null);
            const guesses = ref([]); // { value: number, hint: string, min: number, max: number }
            const gameStatus = ref(null); // 'playing', 'won', 'lost', null
            const message = ref('');
            const language = ref('zh'); // é è¨­ç¹é«”ä¸­æ–‡
            const highScore = ref(null);

            // --- Computed Properties ---
            const t = computed(() => translations[language.value]);
            const currentAttempts = computed(() => guesses.value.length);
            const remainingAttempts = computed(() => maxAttempts.value - currentAttempts.value);
            const gameModes = computed(() => gameModesConfig);
            
            // æ ¹æ“šéŠæˆ²ç‹€æ…‹é¡¯ç¤ºä¸»è¦è¨Šæ¯
            const gameMessage = computed(() => {
                if (gameStatus.value === 'won') {
                    return t.value.status_win;
                }
                if (gameStatus.value === 'lost') {
                    return translate(t.value.status_loss, secretNumber.value);
                }
                if (message.value && gameStatus.value === 'playing') {
                    return message.value;
                }
                // é è¨­æç¤º
                return translate(t.value.status_playing);
            });


            // --- æ–¹æ³• ---

            // 1. éŠæˆ²åˆå§‹åŒ–
            const startGame = () => {
                // æ ¹æ“šç•¶å‰æ¨¡å¼è¨­å®šéŠæˆ²åƒæ•¸
                let currentMin, currentMax, currentAttemptsLimit;

                if (gameModeKey.value === 'custom') {
                    // æª¢æŸ¥ä¸¦ä½¿ç”¨è‡ªè¨‚å€¼ï¼Œç¢ºä¿ç¯„åœæœ‰æ•ˆ
                    currentMin = Math.max(1, customMin.value || 1);
                    currentMax = Math.max(currentMin + 1, customMax.value || 100);
                    currentAttemptsLimit = Math.max(1, customAttempts.value || 10);
                } else {
                    const mode = gameModesConfig[gameModeKey.value];
                    currentMin = mode.min;
                    currentMax = mode.max;
                    currentAttemptsLimit = mode.attempts;
                }
                
                // æ›´æ–°åˆå§‹ç¯„åœå’Œæœ€å¤§å˜—è©¦æ¬¡æ•¸
                initialMin.value = currentMin;
                initialMax.value = currentMax;
                maxAttempts.value = currentAttemptsLimit;

                // ç”Ÿæˆä¸€å€‹æ–°çš„ç§˜å¯†æ•¸å­— (åŒ…å«åœ¨ç¯„åœå…§)
                if ((currentMax - currentMin) <= 2) {
                // è‹¥ç¯„åœç„¡æ³•å½¢æˆé–‹å€é–“ï¼Œå¾€å¤–æ“´æˆ–çµ¦æç¤ºï¼ˆé˜²å‘†ï¼‰
                currentMax = Math.max(currentMax, currentMin + 3);
                }
                const newSecret = Math.floor(Math.random() * (currentMax - currentMin - 1)) + currentMin + 1;
                
                // é‡è¨­ç‹€æ…‹
                secretNumber.value = newSecret;
                minRange.value = currentMin;
                maxRange.value = currentMax; // å¯¦éš›ç¯„åœæ˜¯ [minRange, maxRange] çš„ä¸­é–“
                guess.value = null;
                guesses.value = [];
                gameStatus.value = 'playing';
                message.value = t.value.status_playing;
                isInputInvalid.value = false; // æ¸…é™¤è¼¸å…¥éŒ¯èª¤ç‹€æ…‹
                
                // éŠæˆ²é–‹å§‹å¾Œç«‹å³è¨­ç½®ç„¦é»åˆ°è¼¸å…¥æ¡†
                nextTick(() => guessInputRef.value?.focus());

                // å„²å­˜é…ç½® (ä½†åªåœ¨éŠæˆ²é–‹å§‹æ™‚æ›´æ–°é…ç½®ç‹€æ…‹ï¼Œé«˜åˆ†å¦è¡Œè™•ç†)
                saveState();

                console.log(`New Game Started: Code between ${currentMin} and ${currentMax}. Secret: ${newSecret}`);
            };

            // 2. è™•ç†çŒœæ¸¬
            const makeGuess = () => {
                const currentGuess = parseInt(guess.value);

                // éŒ¯èª¤æª¢æŸ¥ï¼šæ˜¯å¦ç‚ºæœ‰æ•ˆæ•¸å­—
                if (isNaN(currentGuess) || currentGuess === null) {
                    message.value = t.value.error_invalid;
                    isInputInvalid.value = true; // è¨­ç½®éŒ¯èª¤ç‹€æ…‹
                    nextTick(() => guessInputRef.value?.focus());
                    return;
                }
                
                // éŒ¯èª¤æª¢æŸ¥ï¼šæ˜¯å¦åœ¨ç•¶å‰ç¯„åœå…§ (ä¸åŒ…å«é‚Šç•Œ)
                if (currentGuess <= minRange.value || currentGuess >= maxRange.value) {
                    message.value = translate(t.value.error_range, minRange.value, maxRange.value);
                    isInputInvalid.value = true; // è¨­ç½®éŒ¯èª¤ç‹€æ…‹
                    nextTick(() => guessInputRef.value?.focus());
                    return;
                }

                // é©—è­‰æˆåŠŸï¼Œæ¸…é™¤éŒ¯èª¤ç‹€æ…‹
                isInputInvalid.value = false;

                // 1. å‹åˆ©æ¢ä»¶
                if (currentGuess === secretNumber.value) {
                    gameStatus.value = 'won';
                    message.value = t.value.status_win;
                    saveHighScore(currentAttempts.value + 1);
                    guesses.value.unshift({ 
                        value: currentGuess, 
                        hint: translate(t.value.status_win), 
                        min: minRange.value, 
                        max: maxRange.value 
                    });
                    return;
                }

                let hintText = '';
                let newMin = minRange.value;
                let newMax = maxRange.value;

                // 2. æ›´æ–°ç¯„åœ (çµ‚æ¥µå¯†ç¢¼çš„æ ¸å¿ƒé‚è¼¯)
                if (currentGuess < secretNumber.value) {
                    newMin = currentGuess;
                    hintText = translate(t.value.hint_too_low) + `(${currentGuess} - ${maxRange.value})`;
                } else if (currentGuess > secretNumber.value) {
                    newMax = currentGuess;
                    hintText = translate(t.value.hint_too_high) + `(${minRange.value} - ${currentGuess})`;
                }

                // å¯«å…¥çŒœæ¸¬æ­·å²
                guesses.value.unshift({ 
                    value: currentGuess, 
                    hint: hintText, 
                    min: newMin, 
                    max: newMax 
                });

                // æ›´æ–°éŠæˆ²ç¯„åœ
                minRange.value = newMin;
                maxRange.value = newMax;
                message.value = t.value.status_playing;

                // 3. å¤±æ•—æ¢ä»¶
                if (guesses.value.length >= maxAttempts.value) {
                    gameStatus.value = 'lost';
                    message.value = translate(t.value.status_loss, secretNumber.value);
                }

                // é‡è¨­è¼¸å…¥æ¡†
                guess.value = null;
                
                // çŒœæ¸¬å¾Œç«‹å³è¨­ç½®ç„¦é»åˆ°è¼¸å…¥æ¡†
                if (gameStatus.value === 'playing') {
                    nextTick(() => guessInputRef.value?.focus());
                }
            };

            // 3. LocalStorage ç›¸é—œ
            const loadState = () => {
                try {
                    const storedState = JSON.parse(localStorage.getItem(localStorageKey));
                    if (storedState) {
                        // è¼‰å…¥èªè¨€è¨­å®š
                        if (['zh', 'en', 'jp'].includes(storedState.language)) {
                            language.value = storedState.language;
                        }
                        // è¼‰å…¥é«˜åˆ†
                        if (typeof storedState.highScore === 'number' && storedState.highScore > 0) {
                            highScore.value = storedState.highScore;
                        }
                        // è¼‰å…¥éŠæˆ²æ¨¡å¼è¨­å®š
                        if (storedState.gameModeKey && gameModesConfig[storedState.gameModeKey]) {
                            gameModeKey.value = storedState.gameModeKey;
                            if (storedState.gameModeKey === 'custom') {
                                customMin.value = storedState.customMin || 1;
                                customMax.value = storedState.customMax || 100;
                                customAttempts.value = storedState.customAttempts || 10;
                            }
                            // é¦–æ¬¡è¼‰å…¥æ™‚åŒæ­¥ç¯„åœé¡¯ç¤º
                            const mode = storedState.gameModeKey === 'custom' ? { min: storedState.customMin, max: storedState.customMax } : gameModesConfig[storedState.gameModeKey];
                            minRange.value = mode.min;
                            maxRange.value = mode.max;
                        }
                    }
                } catch (e) {
                    console.error("ç„¡æ³•è¼‰å…¥ LocalStorage ç‹€æ…‹:", e);
                }
                // é¦–æ¬¡è¼‰å…¥æˆ–è¼‰å…¥å¤±æ•—å¾Œï¼Œæ ¹æ“šç•¶å‰è¨­å®šé–‹å§‹æ–°éŠæˆ²
                startGame();
            };
            
            const saveState = () => {
                const currentState = {
                    language: language.value,
                    highScore: highScore.value,
                    gameModeKey: gameModeKey.value,
                    customMin: customMin.value,
                    customMax: customMax.value,
                    customAttempts: customAttempts.value,
                };
                localStorage.setItem(localStorageKey, JSON.stringify(currentState));
            };

            const highScores = ref({}); // { [modeKey]: number }

            const saveHighScore = (attempts) => {
            const key = gameModeKey.value;
            const prev = highScores.value[key];
            if (!prev || attempts < prev) {
                highScores.value[key] = attempts;
                saveState();
            }
            };
            
            // 4. èªè¨€åˆ‡æ›
            const changeLanguage = (lang) => {
                language.value = lang;
                message.value = t.value.status_playing; 
                saveState();
            };

            // 5. æ¨¡å¼åˆ‡æ›
            const setGameMode = (key) => {
                gameModeKey.value = key;
                let currentModeConfig;

                if (key !== 'custom') {
                    currentModeConfig = gameModesConfig[key];
                    // å¦‚æœåˆ‡æ›åˆ°é è¨­æ¨¡å¼ï¼Œå‰‡å°‡è‡ªè¨‚è¼¸å…¥æ¡†çš„å€¼æ›´æ–°ç‚ºè©²æ¨¡å¼çš„åƒæ•¸
                    customMin.value = currentModeConfig.min;
                    customMax.value = currentModeConfig.max;
                    customAttempts.value = currentModeConfig.attempts;
                } else {
                    // å°æ–¼è‡ªè¨‚æ¨¡å¼ï¼Œä½¿ç”¨ç•¶å‰è‡ªè¨‚è¼¸å…¥çš„å€¼
                    currentModeConfig = {
                        min: customMin.value,
                        max: customMax.value,
                        attempts: customAttempts.value
                    };
                }
                
                // æ¨¡å¼åˆ‡æ›å¾Œç«‹å³æ›´æ–°é¡¯ç¤ºçš„ç¯„åœ (minRange / maxRange)
                minRange.value = currentModeConfig.min;
                maxRange.value = currentModeConfig.max;

                // ç•¶æ¨¡å¼æ”¹è®Šæ™‚ï¼Œé¼“å‹µç”¨æˆ¶é»æ“Šã€Œé–‹å§‹éŠæˆ²ã€
                message.value = '';
                gameStatus.value = null; 
            };

            // ç›£è½è‡ªè¨‚æ¨¡å¼çš„æ•¸å€¼ï¼Œç•¶å€¼æ”¹è®Šæ™‚ï¼ŒéŠæˆ²ç‹€æ…‹é‡ç½®
            watch([customMin, customMax, customAttempts], () => {
                if (gameModeKey.value === 'custom') {
                    // ç°¡å–®çš„è¼¸å…¥æª¢æŸ¥
                    customMin.value = Math.max(1, customMin.value || 1);
                    customMax.value = Math.max(customMin.value + 1, customMax.value || 100);
                    customAttempts.value = Math.max(1, customAttempts.value || 10);

                    // å³æ™‚åŒæ­¥é¡¯ç¤ºç¯„åœ
                    minRange.value = customMin.value;
                    maxRange.value = customMax.value;
                    
                    // é‡è¨­éŠæˆ²ç‹€æ…‹ï¼Œæç¤ºç”¨æˆ¶é–‹å§‹æ–°éŠæˆ²
                    gameStatus.value = null;
                }
            });


            // é¦–æ¬¡åŠ è¼‰æ™‚è¼‰å…¥ç‹€æ…‹
            loadState();
            
            // å°‡æ–¹æ³•å’Œæ•¸æ“šå›å‚³çµ¦æ¨¡æ¿
            return {
                // Data
                secretNumber,
                minRange,
                maxRange,
                guess,
                guesses,
                gameStatus,
                language,
                highScore,
                gameModeKey,
                gameModes,
                customMin,
                customMax,
                customAttempts,
                guessInputRef,       // å‚³é DOM å¼•ç”¨
                isInputInvalid,      // å‚³ééŒ¯èª¤ç‹€æ…‹

                // Computed
                t,
                currentAttempts,
                remainingAttempts,
                gameMessage,
                maxAttempts, // è®“æ¨¡æ¿å¯ä»¥ç›´æ¥ä½¿ç”¨

                // Methods
                translate,
                startGame,
                makeGuess,
                changeLanguage,
                setGameMode,
            };
        }
    }).mount('#app');
</script>

</body>
</html>
