<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全方位健康數據計算機 (擴充版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
        }
        main {
            flex-grow: 1;
        }
        /* 自定義動畫 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        /* 讓 input[type=number] 隱藏上下箭頭 */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="p-4">

    <!-- 主容器 -->
    <main class="flex items-center justify-center w-full">
        <div class="w-full max-w-5xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-10">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800">全方位健康數據計算機</h1>
                <p class="text-gray-500 mt-2">輸入您的基本資料，健康分析報告將會即時更新。</p>
            </div>

            <!-- 輸入表單 -->
            <form id="health-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- 基本資料 -->
                <div class="form-group">
                    <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">性別</label>
                    <select id="gender" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                        <option value="male">男性</option>
                        <option value="female">女性</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="age" class="block text-sm font-medium text-gray-700 mb-2">年齡 (歲)</label>
                    <input type="number" id="age" placeholder="請輸入" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" min="1" max="120">
                </div>
                <div class="form-group">
                    <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">體重 (公斤)</label>
                    <input type="number" id="weight" placeholder="例如：70" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" min="1" step="0.1">
                </div>
                <div class="form-group">
                    <label for="height" class="block text-sm font-medium text-gray-700 mb-2">身高 (公分)</label>
                    <input type="number" id="height" placeholder="例如：175" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" min="1" step="0.1">
                </div>
                <!-- 圍度資料 (用於體脂計算) -->
                 <div class="form-group">
                    <label for="neck" class="block text-sm font-medium text-gray-700 mb-2">頸圍 (公分)</label>
                    <input type="number" id="neck" placeholder="選填" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" min="1" step="0.1">
                </div>
                 <div class="form-group">
                    <label for="waist" class="block text-sm font-medium text-gray-700 mb-2">腰圍 (公分)</label>
                    <input type="number" id="waist" placeholder="選填" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" min="1" step="0.1">
                </div>
                <div id="hip-group" class="form-group hidden">
                    <label for="hip" class="block text-sm font-medium text-gray-700 mb-2">臀圍 (公分)</label>
                    <input type="number" id="hip" placeholder="選填" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" min="1" step="0.1">
                </div>
            </form>
            
            <!-- 提示訊息 -->
            <div id="prompt-message" class="text-center text-gray-400 p-3 rounded-lg mb-6">請填寫上方必填欄位以查看基礎分析。填寫頸圍、腰圍等數據可獲得更詳細報告。</div>

            <!-- 結果顯示區 -->
            <div id="results-container" class="hidden">
                <!-- 總結 -->
                <div id="summary" class="text-center bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-5 rounded-r-lg mb-8"></div>

                <!-- 詳細數據卡片 -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- BMI -->
                    <div id="bmi-card" class="p-6 rounded-lg shadow-md"></div>
                    <!-- BMR -->
                    <div id="bmr-card" class="bg-white p-6 rounded-lg shadow-md"></div>
                    <!-- 理想體重 -->
                    <div id="ideal-weight-card" class="bg-white p-6 rounded-lg shadow-md"></div>
                    <!-- 體脂率 (BFP) -->
                    <div id="bfp-card" class="p-6 rounded-lg shadow-md hidden"></div>
                    <!-- 除脂體重 (LBM) -->
                    <div id="lbm-card" class="bg-white p-6 rounded-lg shadow-md hidden"></div>
                    <!-- 腰高比 (WHtR) -->
                    <div id="whtr-card" class="p-6 rounded-lg shadow-md hidden"></div>
                    <!-- TDEE -->
                    <div id="tdee-card" class="bg-white p-6 rounded-lg shadow-md md:col-span-2 lg:col-span-3"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- 頁尾 -->
    <footer class="text-center mt-10 p-6 text-sm text-gray-500">
        <div class="max-w-4xl mx-auto">
            <p>&copy; 2024 全方位健康數據計算機. All Rights Reserved.</p>
            <p class="mt-2">
                <a href="#" class="hover:underline">隱私權政策</a> | 
                <a href="#" class="hover:underline">服務條款</a> | 
                <span>Powered by <a href="#" target="_blank" rel="noopener noreferrer" class="font-semibold text-gray-600 hover:text-blue-600">數轉工作室</a></span>
            </p>
        </div>
    </footer>

    <script>
        // DOM 元素
        const inputs = document.querySelectorAll('input, select');
        const resultsContainer = document.getElementById('results-container');
        const promptMessage = document.getElementById('prompt-message');
        const genderSelect = document.getElementById('gender');
        const hipGroup = document.getElementById('hip-group');

        // 監聽性別選擇，動態顯示/隱藏臀圍輸入
        genderSelect.addEventListener('change', () => {
            if (genderSelect.value === 'female') {
                hipGroup.classList.remove('hidden');
            } else {
                hipGroup.classList.add('hidden');
            }
            calculateAndDisplay(); // 性別改變時也重新計算
        });

        // 計算並顯示結果的函數
        const calculateAndDisplay = () => {
            // 1. 獲取基本輸入值
            const gender = genderSelect.value;
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            
            // 2. 驗證基本輸入
            if (!age || !weight || !height || age <= 0 || weight <= 0 || height <= 0) {
                resultsContainer.classList.add('hidden');
                promptMessage.classList.remove('hidden');
                return;
            }
            promptMessage.classList.add('hidden');

            // --- 基礎指標計算 ---
            const heightInMeters = height / 100;
            const bmi = weight / (heightInMeters * heightInMeters);
            
            let bmiStatus, bmiColorClass;
            // ... (BMI 狀態判斷邏輯，與前一版相同)
            if (bmi < 18.5) { bmiStatus = '體重過輕'; bmiColorClass = { text: 'text-blue-600', bg: 'bg-blue-100' }; } 
            else if (bmi < 24) { bmiStatus = '正常範圍'; bmiColorClass = { text: 'text-green-600', bg: 'bg-green-100' }; } 
            else if (bmi < 27) { bmiStatus = '過重'; bmiColorClass = { text: 'text-yellow-600', bg: 'bg-yellow-100' }; } 
            else if (bmi < 30) { bmiStatus = '輕度肥胖'; bmiColorClass = { text: 'text-orange-600', bg: 'bg-orange-100' }; } 
            else if (bmi < 35) { bmiStatus = '中度肥胖'; bmiColorClass = { text: 'text-red-600', bg: 'bg-red-100' }; } 
            else { bmiStatus = '重度肥胖'; bmiColorClass = { text: 'text-red-800', bg: 'bg-red-200' }; }

            const bmr = (gender === 'male')
                ? (10 * weight + 6.25 * height - 5 * age + 5)
                : (10 * weight + 6.25 * height - 5 * age - 161);
            
            const idealWeightLower = 18.5 * (heightInMeters * heightInMeters);
            const idealWeightUpper = 24 * (heightInMeters * heightInMeters);

            // --- 渲染基礎指標 ---
            document.getElementById('summary').innerHTML = `<p class="text-lg">您的 <strong>BMI 為 ${bmi.toFixed(1)}</strong>，屬於「<span class="font-bold ${bmiColorClass.text}">${bmiStatus}</span>」範圍。基礎代謝率 (BMR) 約為 <strong>${bmr.toFixed(0)} 大卡</strong>。</p>`;
            
            const bmiCard = document.getElementById('bmi-card');
            bmiCard.className = `p-6 rounded-lg shadow-md ${bmiColorClass.bg}`;
            bmiCard.innerHTML = `<div class="flex items-center mb-3"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><h3 class="text-lg font-semibold">身體質量指數 (BMI)</h3></div><p class="text-3xl font-bold ${bmiColorClass.text}">${bmi.toFixed(1)}</p><p class="text-sm font-medium mt-1 ${bmiColorClass.text}">${bmiStatus}</p>`;
            
            document.getElementById('bmr-card').innerHTML = `<div class="flex items-center mb-3 text-gray-700"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><h3 class="text-lg font-semibold">基礎代謝率 (BMR)</h3></div><p class="text-3xl font-bold text-gray-800">${bmr.toFixed(0)} <span class="text-base font-medium">大卡/日</span></p><p class="text-sm text-gray-500 mt-1">維持生命所需最低熱量</p>`;
            
            document.getElementById('ideal-weight-card').innerHTML = `<div class="flex items-center mb-3 text-gray-700"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg><h3 class="text-lg font-semibold">理想體重範圍</h3></div><p class="text-3xl font-bold text-gray-800">${idealWeightLower.toFixed(1)} - ${idealWeightUpper.toFixed(1)} <span class="text-base font-medium">公斤</span></p><p class="text-sm text-gray-500 mt-1">基於健康BMI區間 (18.5-24)</p>`;

            const tdeeFactors = [ { label: '久坐', value: 1.2, emoji: ' sedentary' }, { label: '輕度活動', value: 1.375, emoji: '🏃' }, { label: '中度活動', value: 1.55, emoji: '💪' }, { label: '高度活動', value: 1.725, emoji: '🔥' }, { label: '極度活動', value: 1.9, emoji: '🚀' } ];
            const tdeeListHTML = tdeeFactors.map(f => `<li class="flex justify-between items-center p-2 rounded-md hover:bg-gray-50"><span>${f.emoji} ${f.label}</span><strong class="text-blue-600">${(bmr * f.value).toFixed(0)} 大卡</strong></li>`).join('');
            document.getElementById('tdee-card').innerHTML = `<div class="flex items-center mb-4 text-gray-700"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg><h3 class="text-lg font-semibold">每日總消耗熱量 (TDEE)</h3></div><ul class="space-y-3 text-gray-600">${tdeeListHTML}</ul>`;

            // --- 進階指標計算與渲染 ---
            const neck = parseFloat(document.getElementById('neck').value);
            const waist = parseFloat(document.getElementById('waist').value);
            const hip = parseFloat(document.getElementById('hip').value);
            
            const bfpCard = document.getElementById('bfp-card');
            const lbmCard = document.getElementById('lbm-card');
            const whtrCard = document.getElementById('whtr-card');

            // 驗證進階指標所需的輸入
            const isAdvancedDataValid = (gender === 'male' && neck && waist) || (gender === 'female' && neck && waist && hip);

            if (isAdvancedDataValid) {
                let bfp = 0;
                // 美國海軍公式計算 BFP
                if (gender === 'male') {
                    bfp = 86.010 * Math.log10(waist - neck) - 70.041 * Math.log10(height) + 36.76;
                } else {
                    bfp = 163.205 * Math.log10(waist + hip - neck) - 97.684 * Math.log10(height) - 78.387;
                }
                bfp = Math.max(0, bfp); // 確保體脂率不為負

                const lbm = weight * (1 - (bfp / 100));
                const whtr = waist / height;

                // BFP 狀態判斷
                let bfpStatus, bfpColorClass;
                if(gender === 'male'){
                    if(bfp < 6) { bfpStatus = '過低'; bfpColorClass = { text: 'text-blue-600', bg: 'bg-blue-100' }; }
                    else if(bfp <= 17) { bfpStatus = '健康'; bfpColorClass = { text: 'text-green-600', bg: 'bg-green-100' }; }
                    else if(bfp <= 25) { bfpStatus = '偏高'; bfpColorClass = { text: 'text-yellow-600', bg: 'bg-yellow-100' }; }
                    else { bfpStatus = '肥胖'; bfpColorClass = { text: 'text-red-600', bg: 'bg-red-100' }; }
                } else { // female
                    if(bfp < 14) { bfpStatus = '過低'; bfpColorClass = { text: 'text-blue-600', bg: 'bg-blue-100' }; }
                    else if(bfp <= 24) { bfpStatus = '健康'; bfpColorClass = { text: 'text-green-600', bg: 'bg-green-100' }; }
                    else if(bfp <= 31) { bfpStatus = '偏高'; bfpColorClass = { text: 'text-yellow-600', bg: 'bg-yellow-100' }; }
                    else { bfpStatus = '肥胖'; bfpColorClass = { text: 'text-red-600', bg: 'bg-red-100' }; }
                }

                // WHtR 狀態判斷
                let whtrStatus, whtrColorClass;
                if(whtr < 0.4) { whtrStatus = '過瘦'; whtrColorClass = { text: 'text-blue-600', bg: 'bg-blue-100' }; }
                else if(whtr < 0.5) { whtrStatus = '健康'; whtrColorClass = { text: 'text-green-600', bg: 'bg-green-100' }; }
                else if(whtr < 0.6) { whtrStatus = '超重'; whtrColorClass = { text: 'text-yellow-600', bg: 'bg-yellow-100' }; }
                else { whtrStatus = '肥胖'; whtrColorClass = { text: 'text-red-600', bg: 'bg-red-100' }; }

                // 渲染進階指標卡片
                bfpCard.className = `p-6 rounded-lg shadow-md ${bfpColorClass.bg}`;
                bfpCard.innerHTML = `<div class="flex items-center mb-3"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg><h3 class="text-lg font-semibold">體脂率 (BFP)</h3></div><p class="text-3xl font-bold ${bfpColorClass.text}">${bfp.toFixed(1)}<span class="text-base font-medium">%</span></p><p class="text-sm font-medium mt-1 ${bfpColorClass.text}">${bfpStatus}</p>`;
                
                lbmCard.innerHTML = `<div class="flex items-center mb-3 text-gray-700"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg><h3 class="text-lg font-semibold">除脂體重 (LBM)</h3></div><p class="text-3xl font-bold text-gray-800">${lbm.toFixed(1)} <span class="text-base font-medium">公斤</span></p><p class="text-sm text-gray-500 mt-1">肌肉、骨骼與器官重量</p>`;

                whtrCard.className = `p-6 rounded-lg shadow-md ${whtrColorClass.bg}`;
                whtrCard.innerHTML = `<div class="flex items-center mb-3"><svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg><h3 class="text-lg font-semibold">腰高比 (WHtR)</h3></div><p class="text-3xl font-bold ${whtrColorClass.text}">${whtr.toFixed(2)}</p><p class="text-sm font-medium mt-1 ${whtrColorClass.text}">${whtrStatus} (理想值 < 0.5)</p>`;

                bfpCard.classList.remove('hidden');
                lbmCard.classList.remove('hidden');
                whtrCard.classList.remove('hidden');
            } else {
                // 如果進階資料不完整，則隱藏相關卡片
                bfpCard.classList.add('hidden');
                lbmCard.classList.add('hidden');
                whtrCard.classList.add('hidden');
            }

            // 顯示結果區
            if (resultsContainer.classList.contains('hidden')) {
                resultsContainer.classList.remove('hidden');
                resultsContainer.classList.add('fade-in');
            }
        };

        // 為所有輸入框添加 'input' 事件監聽器
        inputs.forEach(input => {
            input.addEventListener('input', calculateAndDisplay);
        });

        // 頁面載入時，根據預設性別（男性）設定臀圍欄位可見性
        if (genderSelect.value === 'female') {
            hipGroup.classList.remove('hidden');
        } else {
            hipGroup.classList.add('hidden');
        }
    </script>
</body>
</html>
